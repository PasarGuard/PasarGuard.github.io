---
title: ุชฺฉโูพูุฑุช ฺฉุฑุฏู ุจุง HAProxy
icon: Network
---

ุจุง ุงู ุขููุฒุด ูโุชููุฏ ุชูุงู ุงุฑุชุจุงุทุงุช ุณุฑูุฑุชูู (ูพููุ ฺฉุงููฺฏโูุง TLS ู REALITY) ุฑู ุงุฒ ุทุฑู ฺฉ ุง ุฏู ูพูุฑุช ุงูุฌุงู ุจุฏุฏ. ุงู ฺฉุงุฑ ุจุงุนุซ ูโุดู ุงุฑุชุจุงุทุงุช ุณุฑูุฑ ุทุจุนโุชุฑ ุจู ูุธุฑ ุจุฑุณูุ ูุญุฏูุฏุชโูุง ุฑู ฺฉ ูพูุฑุช ุฎุงุต ุฑู ุฏูุฑ ุจุฒูุฏ ู ุงููุช ุจุดุชุฑ ุฏุงุดุชู ุจุงุดุฏ.

<Alert type="info">
ุงฺฏู ูพูุฑุช ูพููุชูู ุฑู ุชู ฺฏุฐุดุชู ุนูุถ ฺฉุฑุฏุฏ ู ูโุฎูุงุฏ ููฺฉโูุง ุณุงุจุณฺฉุฑูพุดู ูุจู ูู ฺฉุงุฑ ฺฉููุ ูโุชููุฏ ุจุง ุงู ุฑูุด HAProxy ุฑู ุฑู ูพูุฑุช ูุฏู listen ฺฉูุฏ ู ุชุฑุงูฺฉ ุฑู ุจู ูพูุฑุช ุฌุฏุฏ ุจูุฑุณุชุฏ ุชุง ูุฑ ุฏู ููฺฉ ูุนุงู ุจูููู.
</Alert>

## ูพุดโูุงุฒูุง

ุชู ุงู ุขููุฒุดุ ูุฑุถ ูโฺฉูู ฺฉู:
- ุณุงุจโุฏุงููู ูพูู ุดูุง: `panel.example.com`
- ุณุงุจโุฏุงููู ฺฉุงููฺฏโูุง TLS: `sub.example.com`
- ุขุฏุฑุณ SNI ฺฉุงููฺฏ REALITY: `reality.com`

<Alert type="warning">
ุงฺฏู ูุจูุงู ุงุฒ HAProxy ุจุฑุง ฺฏุฑูุชู SSL ูพูู ุงุณุชูุงุฏู ฺฉุฑุฏุฏุ ุจุงุฏ ุงุฒ ุฑูุด ุฏฺฏูโุง  ุดุฏู ุฏุฑ ุฏุงฺฉูููุช ูุณุช) ุจุฑุง SSL ุงุณุชูุงุฏู ฺฉูุฏ ุชุง ุชุฏุงุฎู ูพุด ูุงุฏ.
</Alert>

## ูุตุจ ู ุฑุงูโุงูุฏุงุฒ HAProxy

### ูุตุจ HAProxy

<Alert type="info">
ูุง HAProxy ุฑู ูุณุชูู ุฑู ุณุฑูุฑ ูุตุจ ูโฺฉููุ ูู ุดูุง ูโุชููุฏ ุชู Docker ูู ูุตุจุด ฺฉูุฏ. ุงฺฏู ูุฑุงุฑู ุจุนุฏุงู ุงุฒ ููุงูู ูพฺุฏูโุชุฑ ุงุณุชูุงุฏู ฺฉูุฏุ HAProxy ุฑู ุงุฒ ูุฎุฒู ุงุตู ุฎูุฏุด ูุตุจ ฺฉูุฏุ ูู ุงุฒ ูุฎุงุฒู ูููฺฉุณ.
</Alert>

ุจุฑุง ูุตุจ ุงู ุฏุณุชูุฑุงุช ุฑู ุงุฌุฑุง ฺฉูุฏ:

```bash
apt update
apt install -y haproxy
```

### ุขูุงุฏูโุณุงุฒ SSL Certificate

ูุจู ุงุฒ ูพฺฉุฑุจูุฏุ ุจุงุฏ SSL certificate ุจุฑุง ุฏุงูููโูุงุชูู ุฏุงุดุชู ุจุงุดุฏ. ุงฺฏู ูููุฒ ูุฏุงุฑุฏุ ูโุชููุฏ ุจุง Certbot ฺฏูุงู ุจฺฏุฑุฏ:

```bash
apt install -y certbot
certbot certonly --standalone -d panel.example.com -d sub.example.com
```

ุจุนุฏ certificate ูุง ุฑู ุจุฑุง HAProxy ุขูุงุฏู ฺฉูุฏ:

```bash
mkdir -p /etc/haproxy/certs
cat /etc/letsencrypt/live/panel.example.com/fullchain.pem \
    /etc/letsencrypt/live/panel.example.com/privkey.pem \
    > /etc/haproxy/certs/panel.example.com.pem
cat /etc/letsencrypt/live/sub.example.com/fullchain.pem \
    /etc/letsencrypt/live/sub.example.com/privkey.pem \
    > /etc/haproxy/certs/sub.example.com.pem
```

### ูพฺฉุฑุจูุฏ HAProxy

ุจุนุฏ ุงุฒ ูุตุจุ ูุงู ูพฺฉุฑุจูุฏ ุงูุฌุง ูุฑุงุฑ ูโฺฏุฑู: `/etc/haproxy/haproxy.cfg`

ูุงู ุฑู ุจุง nano ุจุงุฒ ฺฉูุฏ:

```bash
nano /etc/haproxy/haproxy.cfg
```

ุญุงูุง ุงู ูพฺฉุฑุจูุฏ ุฑู ุจุนุฏ ุงุฒ ุชุบุฑ ุฏุงูููโูุงุชูู ุจู ุงูุชูุง ูุงู ุงุถุงูู ฺฉูุฏ:

```nginx
listen front
    mode http
    option httplog
    log /dev/log local0
    
    # Listen ฺฉุฑุฏู ุฑู ฺูุฏ ูพูุฑุช ููุฒูุงู
    bind :::443 ssl crt /etc/haproxy/certs/
    bind :::80
    bind :::8443 ssl crt /etc/haproxy/certs/
    bind 0.0.0.0:9000
    
    # Capture ฺฉุฑุฏู ุงุทูุงุนุงุช ุจุฑุง ูุงฺฏ
    capture request header X-Forwarded-For len 15
    capture request header Host len 50
    log-format "%ci:%cp [%tr] %ft %b/%s %TR/%Tw/%Tc/%Tr/%Ta %ST %B %CC %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs %{+Q}r %U"
    
    # ACL ุจุฑ ุงุณุงุณ ุฏุงููู
    acl host_panel hdr(host) -i panel.example.com
    acl host_sub   hdr(host) -i sub.example.com
    
    # ุฑูุชูฺฏ ุงูู
    use_backend panel if host_panel
    use_backend sub   if host_sub
    http-request deny

backend panel
    mode http
    server srv1 127.0.0.1:8000

backend sub
    mode http
    acl is_sub path_beg /sub/
    http-request deny if !is_sub
    server srv1 127.0.0.1:8000
```

#### ุชูุถุญ ูพฺฉุฑุจูุฏ

ุงู ูพฺฉุฑุจูุฏ ุญุฑููโุง ุดุงูู:

**Frontend (listen front):**
- **mode http**: ุงุฒ HTTP mode ุงุณุชูุงุฏู ูโฺฉูู ฺฉู ุงูฺฉุงูุงุช ุจุดุชุฑ ุฏุงุฑู
- **bind**: ุฑู ฺูุฏ ูพูุฑุช ููุฒูุงู ฺฏูุด ูโุฏู (443, 80, 8443, 9000)
- **ssl crt**: ุฎูุฏุด SSL handling ุฑู ุงูุฌุงู ูโุฏู
- **capture**: ุงุทูุงุนุงุช ููู ุฑู ุจุฑุง ูุงฺฏ ุฐุฎุฑู ูโฺฉูู
- **log-format**: ูุฑูุช ูุงฺฏ ุฏูู ู ุญุฑููโุง

**ACL (Access Control List):**
- ุจุฑ ุงุณุงุณ ุฏุงููู (`Host` header) ุชุดุฎุต ูโุฏู ฺฉู ุชุฑุงูฺฉ ุจุงุฏ ุจู ฺฉุฌุง ุจุฑู
- ุงููุช ุจุดุชุฑ ุจุง `http-request deny` ุฏุฑ ุงูุชูุง ฺฉู ูุฑ ุฏุฑุฎูุงุณุช ูุงุดูุงุณ ุฑู ุฑุฏ ูโฺฉูู

**Backends:**
- ูุฑ backend ุจุฑุงุณุงุณ ุฏุงูููุ ุชุฑุงูฺฉ ุฑู ุจู ุณุฑูุณ ูุฑุจูุทู ูโูุฑุณุชู
- backend `sub` ฺฉ ูุงู ุงููุช ุงุถุงู ุฏุงุฑู ฺฉู ููุท pathูุง `/sub/` ุฑู ูุจูู ูโฺฉูู

<Alert type="info">
ุจุง `http-request deny` ุฏุฑ ุงูุชูุง frontendุ ูุฑ ุฏุฑุฎูุงุณุช ฺฉู ุจุง ุฏุงูููโูุง ุชุนุฑูโุดุฏู ูุทุงุจูุช ูุฏุงุฑูุ ูุณุฏูุฏ ูโุดู. ุงู ุงุฒ ุณูุงุณุชูุงุฏู ุงุฒ IP ุดูุง ุฌููฺฏุฑ ูโฺฉูู.
</Alert>

ุจุนุฏ ุงุฒ ูุฑุงุดุ ูุงู ุฑู save ฺฉูุฏ (Ctrl+Xุ ุณูพุณ Yุ ุณูพุณ Enter) ู HAProxy ุฑู ุฑุณุชุงุฑุช ฺฉูุฏ:

```bash
systemctl restart haproxy
systemctl status haproxy
```

## ูพฺฉุฑุจูุฏ ฺฉุงููฺฏโูุง

<Alert type="info">
ุจุง ุงุณุชูุงุฏู ุงุฒ HTTP mode ุฏุฑ HAProxyุ ูพูู ู ุณุฑูุณโูุง TLS ุดูุง ุจู ุฑุงุญุช ุฑู ฺูุฏ ูพูุฑุช ุฏุฑ ุฏุณุชุฑุณ ูโุดู ู SSL handling ูู ุชูุณุท HAProxy ุงูุฌุงู ูโุดู.
</Alert>

### ฺฉุงููฺฏโูุง ูพูู ู TLS

ุงฺฏู ุงุฒ ูพฺฉุฑุจูุฏ ุจุงูุง ุงุณุชูุงุฏู ูโฺฉูุฏุ ูพูู ู ฺฉุงููฺฏโูุง TLS ุดูุง ุจุงุฏ ุฑู ูพูุฑุชโูุง ููฺฉุงู (ูุซู `8000`) listen ฺฉูู ู HAProxy ุชุฑุงูฺฉ ุฑู ุจู ุงูููุง ูุฏุงุช ูโฺฉูู.

ุฏุฑ ุชูุธูุงุช ูพูู:
- **Panel Host**: `127.0.0.1`  
- **Panel Port**: `8000`

### ฺฉุงููฺฏโูุง REALITY (ุจุฑุง Nodeูุง)

ุจุฑุง ููุฏูุง ฺฉู ูุงุฒ ุจู REALITY ุฏุงุฑูุ ุจูุชุฑู ุงุฒ TCP mode ุงุณุชูุงุฏู ฺฉูุฏ. ุงู ูพฺฉุฑุจูุฏ ุฑู ุฑู ููุฏูุงุชูู ูุฑุงุฑ ุจุฏุฏ:

```nginx
listen front_node
    mode tcp
    bind *:443

    tcp-request inspect-delay 5s
    tcp-request content accept if { req_ssl_hello_type 1 }

    use_backend reality if { req.ssl_sni -m end reality.com }
    default_backend fallback_node

backend fallback_node
    mode tcp
    server srv1 127.0.0.1:11000

backend reality
    mode tcp
    server srv1 127.0.0.1:12000 send-proxy
```

ููููู ูพฺฉุฑุจูุฏ Inbound REALITY:

```json
{
    "tag": "VLESS_TCP_REALITY",
    "listen": "127.0.0.1",
    "port": 12000,
    "protocol": "vless",
    "settings": {
        "clients": [],
        "decryption": "none"
    },
    "streamSettings": {
        "network": "tcp",
        "tcpSettings": {
            "acceptProxyProtocol": true
        },
        "security": "reality",
        "realitySettings": {
            "show": false,
            "dest": "example.com:443",
            "xver": 0,
            "serverNames": [
                "reality.com"
            ],
            "privateKey": "YOUR_PRIVATE_KEY",
            "shortIds": [
                ""
            ]
        }
    },
    "sniffing": {
        "enabled": true,
        "destOverride": [
            "http",
            "tls"
        ]
    }
}
```

**ูฺฉุงุช ููู:**
- `listen` ุฑู ุฑู `127.0.0.1` ุจุฐุงุฑุฏ (ูู `0.0.0.0`)
- `acceptProxyProtocol` ุฑู `true` ฺฉูุฏ
- ูุฑ Inbound ุจุงุฏ ูพูุฑุช ููฺฉุงู ููุญุตุฑุจูโูุฑุฏ ุฏุงุดุชู ุจุงุดู

### ฺฉุงููฺฏโูุง TLS ุจุง Fallback

ุจุฑุง ุชฺฉโูพูุฑุช ฺฉุฑุฏู ฺฉุงููฺฏโูุง TLSุ ุงุฒ ูุงุจูุช Fallback ุงุณุชูุงุฏู ูโฺฉูู.

#### Inbound ุงุตู Fallback

```json
{
    "tag": "TROJAN_FALLBACK_INBOUND",
    "listen": "127.0.0.1",
    "port": 11000,
    "protocol": "trojan",
    "settings": {
        "clients": [],
        "decryption": "none",
        "fallbacks": [
            {
                "path": "/vless",
                "dest": "@vless-ws",
                "xver": 2
            },
            {
                "path": "/vmess",
                "dest": "@vmess-ws",
                "xver": 2
            },
            {
                "path": "/trojan",
                "dest": "@trojan-ws",
                "xver": 2
            }
        ]
    },
    "streamSettings": {
        "network": "tcp",
        "security": "tls",
        "tlsSettings": {
            "serverName": "sub.example.com",
            "certificates": [
                {
                    "ocspStapling": 3600,
                    "certificateFile": "/var/lib/pasarguard/certs/fullchain.pem",
                    "keyFile": "/var/lib/pasarguard/certs/key.pem"
                }
            ],
            "minVersion": "1.2",
            "cipherSuites": "TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256:TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256:TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384:TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384",
            "alpn": [
                "http/1.1"
            ]
        }
    },
    "sniffing": {
        "enabled": true,
        "destOverride": [
            "http",
            "tls"
        ]
    }
}
```

#### Inboundูุง WebSocket

ุญุงูุง ุจุงุฏ Inboundูุง WebSocket ุฑู ุจุง listen ุจู ุตูุฑุช Unix socket ุชุนุฑู ฺฉูุฏ:

**VLESS WebSocket:**

```json
{
    "tag": "VLESS_WS_INBOUND",
    "listen": "@vless-ws",
    "protocol": "vless",
    "settings": {
        "clients": [],
        "decryption": "none"
    },
    "streamSettings": {
        "network": "ws",
        "wsSettings": {
            "acceptProxyProtocol": true,
            "path": "/vless"
        }
    }
}
```

**VMess WebSocket:**

```json
{
    "tag": "VMESS_WS_INBOUND",
    "listen": "@vmess-ws",
    "protocol": "vmess",
    "settings": {
        "clients": []
    },
    "streamSettings": {
        "network": "ws",
        "wsSettings": {
            "acceptProxyProtocol": true,
            "path": "/vmess"
        }
    }
}
```

<Alert type="warning">
ุฏุฑ Inboundูุง ฺฉู `listen` ุจู ุตูุฑุช `@xxx` ุชุนุฑู ุดุฏูุ ุฎุท `port` ุฑู ุญุฐู ฺฉูุฏ.
</Alert>

#### ุชูุธู Fallback Tag

ุงฺฏู ุงุฒ Fallback ุงุณุชูุงุฏู ูโฺฉูุฏุ ุจุงุฏ ุฏุฑ ุชูุธูุงุช ูพุงุณุงุฑฺฏุงุฑุฏ ุงู ูุชุบุฑ ุฑู ุณุช ฺฉูุฏ:

ุชู ูพูู ุจุฑูุฏ ุจู **ุชูุธูุงุช โ ูุณุชู** ู Fallback Inbound Tag ุฑู ูุทุงุจู ุจุง tag Inbound ุงุตูุชูู ุชูุธู ฺฉูุฏ:

```
TROJAN_FALLBACK_INBOUND
```

<Alert type="tip">
ูโุชููุฏ ุจู ุฌุง ุงุณุชูุงุฏู ุงุฒ Fallbackุ ุจุฑุง ูุฑ ฺฉุงููฺฏ ฺฉ ุณุงุจโุฏุงููู ุฌุฏุงฺฏุงูู ุชุนุฑู ฺฉูุฏ ู ุจุง HAProxy ุจุฑ ุงุณุงุณ SNI ุจูุดูู ุชูฺฉฺฉ ุงุฌุงุฏ ฺฉูุฏ. ุงู ุฑูุด ุจุงุฑ ูพุฑุฏุงุฒุด ฺฉูุชุฑ ุฏุงุฑู.
</Alert>

## ุชูุธูุงุช ูพูู

ุจุง ุงุณุชูุงุฏู ุงุฒ HTTP mode ุฏุฑ HAProxyุ ูพูู ุดูุง ุจู ุฑุงุญุช ุฏุฑ ุฏุณุชุฑุณ ูโุดู.

ุชู ูพูู ูพุงุณุงุฑฺฏุงุฑุฏ ุจุฑูุฏ ุจู **ุชูุธูุงุช โ ูพูู** ู ุงู ููุงุฑุฏ ุฑู ุชูุธู ฺฉูุฏ:

- **Panel Host**: `127.0.0.1`
- **Panel Port**: `8000`

<Alert type="tip">
ฺูู HAProxy ุฎูุฏุด SSL handling ุฑู ุงูุฌุงู ูโุฏูุ ูุงุฒ ูุณุช ฺฉู ูพูู ุฑู HTTPS ุงุฌุฑุง ุจุดู. ุงุฑุชุจุงุท ุจู HAProxy ู ูพูู ุฑู localhost ู HTTP ูุณุชุ ูู ฺฉุงุฑุจุฑุงู ุงุฒ ุทุฑู HTTPS ุจู ูพูู ุฏุณุชุฑุณ ุฏุงุฑู.
</Alert>

## ุชูุธูุงุช Host

ุจุง ูพฺฉุฑุจูุฏ HAProxy ุฌุฏุฏ:

1. ุจุฑุฏ ุจู **ูุงุณุชโูุง** ุฏุฑ ูพูู
2. ูุฑ Host ุฑู ูุฑุงุด ฺฉูุฏ  
3. ูพูุฑุช ุฑู ุฑู `443` (ุง `80` ุง `8443` ุง `9000` - ูุฑ ฺฉุฏูู ฺฉู ูโุฎูุงุฏ) ุจุฐุงุฑุฏ
4. ุฐุฎุฑู ฺฉูุฏ

<Alert type="info">
ฺูู HAProxy ุฑู ฺูุฏ ูพูุฑุช ููุฒูุงู listen ูโฺฉููุ ูโุชููุฏ ุจู ฺฉุงุฑุจุฑุงู ูุฎุชูู ูพูุฑุชโูุง ูุฎุชูู ุจุฏุฏ. ูุซูุงู ู ฺฉุงุฑุจุฑ ุงุฒ ูพูุฑุช 443 ู ฺฉ ุฏฺฏู ุงุฒ ูพูุฑุช 8443 ุงุณุชูุงุฏู ฺฉูู.
</Alert>

## ูพฺฉุฑุจูุฏ Nodeูุง

<Alert type="warning">
ุชูุธูุงุช HAProxy ุจุงุฏ ุฑู **ุชูุงู Nodeูุง ุดูุง** ูู ุงูุฌุงู ุจุดู. ุจุฑุง ููุฏูุง ุชูุตู ูโฺฉูู ุงุฒ TCP mode ุงุณุชูุงุฏู ฺฉูุฏ (ูุซู ูพฺฉุฑุจูุฏ ุจุงูุง ุจุฑุง REALITY).
</Alert>

### ููููู ูพฺฉุฑุจูุฏ Node ุจุง TCP Mode

```nginx
listen front_node
    mode tcp
    bind *:443

    tcp-request inspect-delay 5s
    tcp-request content accept if { req_ssl_hello_type 1 }

    # ุชูฺฉฺฉ ุจุฑ ุงุณุงุณ SNI
    use_backend vless_reality if { req.ssl_sni -m end reality1.com }
    use_backend vmess_tls if { req.ssl_sni -m end tls1.com }
    default_backend fallback_node

backend fallback_node
    mode tcp
    server srv1 127.0.0.1:11000

backend vless_reality
    mode tcp
    server srv1 127.0.0.1:12000 send-proxy

backend vmess_tls
    mode tcp  
    server srv1 127.0.0.1:13000
```

ุงู ุฑูุด ุจุฑุง ููุฏูุง ฺฉู ฺูุฏ protocol ูุฎุชูู ุฏุงุฑู ู ูุงุฒ ุจู ุชูฺฉฺฉ ุจุฑ ุงุณุงุณ SNI ุฏุงุฑูุ ููุงุณุจู.

## ูฺฉุงุช ููู

<Alert type="danger">
**SSL Certificate**: Certificate ูุง SSL ุจุงุฏ ุจู ุตูุฑุช ุชุฑฺฉุจ (fullchain + privkey) ุฏุฑ ูพูุดู `/etc/haproxy/certs/` ูุฑุงุฑ ุจฺฏุฑู. ุงฺฏู certificate ูุง ุฑู ุชูุฏุฏ ฺฉุฑุฏุฏุ ุญุชูุงู ูุงูโูุง ุชุฑฺฉุจ ุฑู ุฏูุจุงุฑู ุจุณุงุฒุฏ ู HAProxy ุฑู reload ฺฉูุฏ:

```bash
systemctl reload haproxy
```
</Alert>

<Alert type="danger">
**ูุญุฏูุฏฺฉููุฏู IP:** ุงฺฏู ุงุฒ IP limiter ุงุณุชูุงุฏู ูโฺฉูุฏ ู ุงุฒ TCP mode (ุจุฑุง REALITY) ุงุณุชูุงุฏู ูโฺฉูุฏุ ุญุชูุงู:
1. `send-proxy` ุฑู ุจู ุงูุชูุง ูุฑ `server` ุฏุฑ backend HAProxy ุงุถุงูู ฺฉูุฏ
2. `"acceptProxyProtocol": true` ุฑู ุฏุฑ ฺฉุงููฺฏ Inbound ูุฑุงุฑ ุจุฏุฏ

ุฏุฑ HTTP mode ูุงุฒ ุจู ุงู ุชูุธูุงุช ูุณุชุ ฺูู HAProxy ุฎูุฏุด IP ูุงูุน ุฑู ุจุง header `X-Forwarded-For` ูโูุฑุณุชู.
</Alert>

<Alert type="warning">
**Firewall**: ูุทูุฆู ุจุดุฏ ฺฉู ูพูุฑุชโูุง ููุฑุฏ ุงุณุชูุงุฏู (443, 80, 8443, 9000) ุฏุฑ ูุงุฑูุงู ุจุงุฒ ูุณุชู:

```bash
ufw allow 443/tcp
ufw allow 80/tcp
ufw allow 8443/tcp
ufw allow 9000/tcp
```
</Alert>

<Alert type="info">
**ูุงฺฏโฺฏุฑ ุญุฑููโุง**: ุจุง ูุฑูุช ูุงฺฏ ุชุนุฑูโุดุฏู ุฏุฑ HAProxyุ ุงุทูุงุนุงุช ฺฉุงูู ุงุฒ ุชูุงู ุฏุฑุฎูุงุณุชโูุง ุฐุฎุฑู ูโุดู. ุงู ูุงฺฏโูุง ุฑู ูโุชููุฏ ุฏุฑ `/var/log/haproxy.log` ุจุจูุฏ.

ุจุฑุง ูุนุงูโุณุงุฒ ูุงฺฏโฺฏุฑุ ููฺฉูู ูุงุฒ ุจุงุดู rsyslog ุฑู ูพฺฉุฑุจูุฏ ฺฉูุฏ:

```bash
echo '$ModLoad imudp' >> /etc/rsyslog.d/49-haproxy.conf
echo '$UDPServerRun 514' >> /etc/rsyslog.d/49-haproxy.conf
echo 'local0.* /var/log/haproxy.log' >> /etc/rsyslog.d/49-haproxy.conf
systemctl restart rsyslog
```
</Alert>

## ุนุจโุงุจ

### HAProxy ุดุฑูุน ููโุดู

ูุถุนุช ู ูุงฺฏโูุง HAProxy ุฑู ฺฺฉ ฺฉูุฏ:

```bash
systemctl status haproxy
journalctl -u haproxy -n 50
```

ุงฺฏู ุฎุทุง syntax ุฏุงุฑูุ ูุงู ฺฉุงููฺฏ ุฑู ุชุณุช ฺฉูุฏ:

```bash
haproxy -c -f /etc/haproxy/haproxy.cfg
```

### ุฎุทุง SSL Certificate

ุงฺฏู HAProxy ุจุง ุฎุทุง certificate ุดุฑูุน ููโุดู:

```bash
# ฺฺฉ ฺฉูุฏ ฺฉู ูุงู certificate ูุฌูุฏ ุฏุงุฑู
ls -la /etc/haproxy/certs/

# ูุฌูุฒูุง ุฑู ฺฺฉ ฺฉูุฏ
chmod 600 /etc/haproxy/certs/*.pem

# certificate ุฑู ุชุณุช ฺฉูุฏ
openssl x509 -in /etc/haproxy/certs/panel.example.com.pem -text -noout
```

### ูพูู ุง ฺฉุงููฺฏโูุง ูุตู ููโุดู

1. ูุทูุฆู ุจุดุฏ HAProxy ุฏุฑ ุญุงู ุงุฌุฑุงุณุช:
```bash
systemctl status haproxy
```

2. ฺฺฉ ฺฉูุฏ ฺฉู ูพูุฑุชโูุง ุจู ุฏุฑุณุช ุจุงุฒ ุจุงุดู:
```bash
netstat -tulpn | grep haproxy
```

3. ุชุณุช ฺฉูุฏ ฺฉู ุณุฑูุณโูุง ููฺฉุงู ฺฉุงุฑ ูโฺฉูู:
```bash
curl -I http://127.0.0.1:8000
netstat -tulpn | grep "8000"
```

4. ูุงฺฏโูุง HAProxy ุฑู real-time ุจุจูุฏ:
```bash
tail -f /var/log/haproxy.log
```

### ุชุฑุงูฺฉ ุจู backend ุงุดุชุจุงู ูโุฑู

1. ACL ูุง ุฑู ฺฺฉ ฺฉูุฏ - ูุทูุฆู ุจุดุฏ ุฏุงูููโูุง ุฏุฑุณุช ููุดุชู ุดุฏู
2. ุชุณุช ฺฉูุฏ ุจุง curl:
```bash
curl -H "Host: panel.example.com" https://YOUR_SERVER_IP
curl -H "Host: sub.example.com" https://YOUR_SERVER_IP
```

3. ูุทูุฆู ุจุดุฏ DNS ูุง ุฏุฑุณุช ุชูุธู ุดุฏู:
```bash
nslookup panel.example.com
nslookup sub.example.com
```

## ุฌูุนโุจูุฏ

ุจุง ุชฺฉูู ุงู ูุฑุงุญู:
- โ ุชูุงู ุชุฑุงูฺฉ ุงุฒ ฺูุฏ ูพูุฑุช ููุฒูุงู (443, 80, 8443, 9000) ูุงุจู ุฏุณุชุฑุณ ูุณุช
- โ ูพูู ุจุง HTTPS ุงูู ุฏุฑ ุฏุณุชุฑุณู
- โ HAProxy ุฎูุฏุด SSL handling ุฑู ุงูุฌุงู ูโุฏู
- โ ูุงฺฏโฺฏุฑ ุญุฑููโุง ู ุฏูู
- โ ุงููุช ุจุงูุง ุจุง ACL ู deny ฺฉุฑุฏู ุชุฑุงูฺฉโูุง ูุงุฎูุงุณุชู
- โ ูุฏุฑุช ุฑุงุญุชโุชุฑ ู ูุฑฺฉุฒ
- โ ูุงุจูุช ุงุณุชูุงุฏู ุงุฒ TCP mode ุจุฑุง ููุฏูุง

<Alert type="success">
ุญุงูุง ูโุชููุฏ ุจุง ุฎุงู ุฑุงุญุช ุงุฒ ุณุฑูุฑ ุชฺฉโูพูุฑุช (ุง ฺูุฏ ูพูุฑุช) ุฎูุฏุชูู ุงุณุชูุงุฏู ฺฉูุฏ! ุงู ูพฺฉุฑุจูุฏ ุญุฑููโุง ุจู ุดูุง ุงูฺฉุงู ูโุฏู ุชุง ููู ุณุฑูุณโูุงุชูู ุฑู ุงุฒ ฺฉ ููุทู ูุฏุฑุช ฺฉูุฏ. ๐
</Alert>
