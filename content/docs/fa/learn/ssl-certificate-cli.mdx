---
title: صدور گواهی SSL
navigation: گواهی SSL
icon: Shield
---

راهنمای زیر نحوهٔ دریافت گواهی‌های SSL برای استفاده با پاسارگارد از طریق خط فرمان (CLI) را نشان می‌دهد.

<Callout type="warn">
فایل‌های گواهی باید قابل دسترسی در مسیر `/var/lib/pasarguard/certs` باشند تا پاسارگارد بتواند از آن‌ها استفاده کند.

در تمام مثال‌های زیر فایل‌ها در این مسیر نصب خواهند شد.
</Callout>

<Callout type="warn">
قبل از درخواست گواهی، باید رکوردهای DNS مربوط به دامنهٔ خود را ثبت کنید.
</Callout>

## دریافت گواهی با acme.sh

### نصب پیش‌نیازها

برای حالت standalone بستهٔ `socat` را نصب کنید:

```bash
apt install curl socat -y
```

<Callout type="info">
اگر قبلاً `socat` را نصب کرده‌اید، نیازی به تکرار این مرحله نیست.
</Callout>

### نصب acme.sh

ابزار [acme.sh](https://github.com/acmesh-official/acme.sh) را به‌صورت زیر نصب کنید.

`YOUR_EMAIL` را با آدرس ایمیل خود جایگزین کنید.

<Callout type="info">
اگر قبلاً `acme.sh` را نصب کرده‌اید، این مرحله را رد کنید.
</Callout>

```bash
curl https://get.acme.sh | sh -s email=YOUR_EMAIL
```

### درخواست گواهی

برای دریافت گواهی دستورات زیر را به‌ترتیب اجرا کنید.

`YOUR_DOMAIN` را با دامنه یا زیردامنهٔ موردنظر جایگزین کنید.

```bash
export DOMAIN=YOUR_DOMAIN

mkdir -p /var/lib/pasarguard/certs

~/.acme.sh/acme.sh \
  --issue --force --standalone -d "$DOMAIN" \
  --fullchain-file "/var/lib/pasarguard/certs/$DOMAIN.cer" \
  --key-file "/var/lib/pasarguard/certs/$DOMAIN.cer.key"
```

## دریافت گواهی برای دامنه‌های Cloudflare

اگر دامنه‌تان در Cloudflare ثبت شده و روش‌های بالا جواب نداد، از حالت دستی (manual) استفاده کنید.

`example.com` را با دامنهٔ خود جایگزین کنید.

### نصب acme.sh

پس از نصب acme، مراحل زیر را اجرا کنید:

```bash
curl https://get.acme.sh | sh -s email=YOUR_EMAIL
```

### مرحلهٔ ۱: درخواست گواهی

```bash
~/.acme.sh/acme.sh --issue -d example.com --dns \
 --yes-I-know-dns-manual-mode-enough-go-ahead-please
```

پس از اجرا، دو مقدار به شما نمایش داده می‌شود (مطابق تصویر):

<ImageZoom
  src="/images/learn/ssl-cloudflare-dns-values.png"
  alt="مقادیر تأیید DNS از Cloudflare"
  width={800}
  height={400}
/>

### مرحلهٔ ۲: تنظیم رکورد DNS

به Cloudflare مراجعه کرده و یک رکورد TXT بسازید و مقادیر نمایش داده‌شده را وارد کنید (مطابق تصویر):

<ImageZoom
  src="/images/learn/ssl-cloudflare-txt-record.png"
  alt="ساخت رکورد TXT در Cloudflare"
  width={800}
  height={400}
/>

### مرحلهٔ ۳: دریافت نهایی گواهی

گواهی نهایی را با دستور زیر دریافت کنید:

```bash
~/.acme.sh/acme.sh --renew -d example.com \
  --yes-I-know-dns-manual-mode-enough-go-ahead-please
```

### مسیر فایل‌ها

در نهایت فایل گواهی دامنه شما در مسیر زیر قرار خواهد داشت:

```
/root/.acme.sh/example.com_ecc/fullchain.cer
```

و کلید خصوصی در مسیر زیر ذخیره خواهد شد:

```
/root/.acme.sh/example.com_ecc/example.com.key
```
