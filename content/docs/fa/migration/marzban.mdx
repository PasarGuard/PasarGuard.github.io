---
title: Marzban به پاسارگارد
icon: ArrowRightLeft
---

<Alert type="warning">
این راهنما برای نسخه‌های `beta-3` و پایین‌تر Marzban هست.
</Alert>

این راهنما بهتون کمک می‌کنه تا اطلاعات، تنظیمات و اکانت‌های کاربریتون رو از Marzban به پاسارگارد منتقل کنید، بدون اینکه چیزی از دست بره.

دو روش مهاجرت توضیح داده می‌شه. شما می‌تونید هر کدوم که باهاش راحت‌تر هستید رو انتخاب کنید.

- [Marzban مهاجرت از نصب فعلی](/fa/migration/marzban/#مراحل-مهاجرت-نصب-فعلی)

همه تنظیمات و فایل‌های فعلی شما حفظ می‌شن. نیازی به سرور جدید نیست، ولی کمی پیچیده‌تره و دستورات بیشتری داره.

- [PasarGuard مهاجرت با نصب جدید](/fa/migration/marzban/#مراحل-مهاجرت-نصب-جدید)

این روش راحت‌تر و سریع‌تره، با دستورات کمتر. ولی به سرور جدید نیاز داره و بعضی تنظیمات رو باید بعد از مهاجرت به‌صورت دستی انجام بدید.

## پیش‌نیازها

> ⚠️ **مهم**: همیشه قبل از شروع فرآیند مهاجرت، یه بک‌آپ کامل از اطلاعاتتون داشته باشید.

- مطمئن بشید که به سرورتون دسترسی root دارید.
- یه بک‌آپ از نصب فعلی Marzban داشته باشید.
- چک کنید که Docker و Docker Compose نصب باشن.

## مراحل مهاجرت: نصب فعلی

### 1. سرویس‌های Marzban رو متوقف کنید

اول از همه، همه کانتینرهای در حال اجرای Marzban رو متوقف کنید:

#### دستورات توقف سرویس

```bash
cd /opt/marzban
docker compose down
```

### 2. اسم پوشه اصلی رو عوض کنید

اگه پوشه‌های پاسارگارد از قبل وجود دارن، اونها رو حذف کنید:

#### دستور حذف پوشه‌ها

```bash
rm -r /opt/pasarguard /var/lib/pasarguard /var/lib/mysql/pasarguard
```

اسم پوشه اصلی Marzban رو به PasarGuard تغییر بدید:

#### دستور تغییر نام پوشه

```bash
sudo mv /opt/marzban /opt/pasarguard
```

### 3. اسم پوشه دیتا رو عوض کنید

اسم پوشه دیتا رو هم تغییر بدید:

#### دستور تغییر نام پوشه دیتا

```bash
sudo mv /var/lib/marzban /var/lib/pasarguard
```

### 4. اسم پوشه MySQL رو عوض کنید (اگه استفاده می‌کنید)

اگه از MySQL یا MariaDB استفاده می‌کنید و یه پوشه اختصاصی برای دیتابیس Marzban دارید:

#### دستور تغییر نام پوشه MySQL

```bash
sudo mv /var/lib/mysql/marzban /var/lib/mysql/pasarguard
```

<Alert type="info">
اگر با خطای «فایل یا پوشه وجود ندارد» مواجه شدید، ممکنه پوشه MySQL متفاوت باشد. در این صورت از این دستور استفاده کنید:
```bash
mkdir -p /var/lib/mysql/pasarguard
mv /var/lib/pasarguard/mysql/* /var/lib/mysql/pasarguard
rm -r /var/lib/pasarguard/mysql
```
</Alert>

### 5. متغیرهای محیطی رو به‌روز کنید

برید به پوشه جدید PasarGuard و فایل محیطی رو به‌روز کنید:

```bash
cd /opt/pasarguard
```

همه مسیرهای اشاره شده تو فایل `.env` رو با یه دستور ساده به‌روز کنید:

```bash
sudo sed -i 's|/var/lib/marzban|/var/lib/pasarguard|g' .env
```

<Alert type="warning">
اگه از نسخه قدیمی (0.8.4 یا پایین‌تر) استفاده می‌کنید، باید درایور SQL رو هم تغییر بدید:
</Alert>

فایل `.env` رو باز کنید:

```bash
nano .env
```

<Tabs items={['SQLite', 'MySQL']}>
  <Tab value="SQLite">
    <div dir="rtl">
      ### به‌روزرسانی درایور SQLite

      ❌ قدیمی
      ```dotenv
      SQLALCHEMY_DATABASE_URL = "sqlite:////var/lib/marzban/db.sqlite3"
      ```
      ✅ جدید
      ```dotenv
      SQLALCHEMY_DATABASE_URL = "sqlite+aiosqlite:////var/lib/pasarguard/db.sqlite3"
      ```
    </div>
  </Tab>

  <Tab value="MySQL">
    <div dir="rtl">
      ### به‌روزرسانی درایور MySQL
      برای MariaDB، همون روندی که برای MySQL هست رو دنبال کنید.
      > ⚠️ **توجه**: در این مثال، مقدار `MYSQL_ROOT_PASSWORD` باید با مقدار واقعی اون در فایل `.env` شما جایگزین بشه.

      ❌ قدیمی
      ```dotenv
      SQLALCHEMY_DATABASE_URL = "mysql+pymysql://root:MYSQL_ROOT_PASSWORD@127.0.0.1/marzban"
      ```
      ✅ جدید
      ```dotenv
      SQLALCHEMY_DATABASE_URL = "mysql+asyncmy://root:MYSQL_ROOT_PASSWORD@127.0.0.1/pasarguard"
      ```
    </div>
  </Tab>
</Tabs>

### سایر تغییرات

اگر در فایل `.env` خود از `V2RAY_SUBSCRIPTION_TEMPLATE` استفاده می‌کنید یا یک `TLS Inbound` تنظیم شده دارید، باید اون‌ها رو به‌روز کنید؛ در غیر این صورت می‌تونید این مرحله رو رد کنید.

#### دستور تغییر نام پوشه v2ray به xray

پوشه v2ray رو با این دستور به xray تغییر بدید:

```bash
mv /var/lib/pasarguard/templates/v2ray /var/lib/pasarguard/templates/xray
```

#### به‌روزرسانی پوشه‌های گواهی xray-config

اگر یک `TLS Inbound` دارید، باید `xray_config.json` رو ویرایش کنید و پوشه‌های گواهی را از marzban به pasarguard تغییر بدید:

```bash
nano /var/lib/pasarguard/xray_config.json
```

پس از تغییرات، فایل `.env` و `xray_config.json` شما باید چیزی شبیه به این باشه:

<Tabs items={['XRAY_SUBSCRIPTION_TEMPLATE', 'Xray-Config Certificate Directories']}>
  <Tab value="XRAY_SUBSCRIPTION_TEMPLATE">
    <div dir="rtl">
      ### به‌روزرسانی تمپلیت Xray در `.env`

      ❌ قدیمی
      ```dotenv
      V2RAY_SUBSCRIPTION_TEMPLATE = "v2ray/default.json"
      ```
      ✅ جدید
      ```dotenv
      XRAY_SUBSCRIPTION_TEMPLATE = "xray/default.json"
      ```
    </div>
  </Tab>

  <Tab value="Xray-Config Certificate Directories">
    <div dir="rtl">
      ### به‌روزرسانی پوشه‌های گواهی در `xray_config.json`

      ❌ قدیمی
      ```json
            "certificates": [
              {
                "certificateFile": "/var/lib/marzban/certs/example.com/fullchain.pem",
                "keyFile": "/var/lib/marzban/certs/example.com/key.pem"
              }
            ],
      ```
      ✅ جدید
      ```json
            "certificates": [
              {
                "certificateFile": "/var/lib/pasarguard/certs/example.com/fullchain.pem",
                "keyFile": "/var/lib/pasarguard/certs/example.com/key.pem"
              }
            ],
      ```
    </div>
  </Tab>
</Tabs>

### 6. فایل Docker Compose رو به‌روز کنید

فایل `docker-compose.yml` رو برای نشون دادن مسیرهای جدید به‌روز کنید. باید این فایل رو دستی ویرایش کنید:

```bash
sudo nano docker-compose.yml
```

#### تغییرات Docker Compose

اینجا یه مقایسه هست که تغییرات لازم رو برای هر دیتابیس نشون میده:

<Accordions type="multiple">
  <Accordion title="SQLite">
<div className="grid md:grid-cols-2 gap-4">

<div className="space-y-2">

**❌ قبل (Marzban)**
```yaml
services:
  marzban:
    image: gozargah/marzban:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/marzban:/var/lib/marzban
```

</div>

<div className="space-y-2">

**✅ بعد (PasarGuard)**
```yaml
services:
  pasarguard:
    image: pasarguard/panel:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/pasarguard:/var/lib/pasarguard
```

</div>

</div>

</Accordion>

<Accordion title="MySQL">
  <Alert type="warning">
    ⚠️ **توجه**: اگه از قبل از ایمیج `mysql:latest` استفاده می‌کنید، اون رو به ایمیج `mysql:lts` تغییر ندید، چون گاهی ممکنه مشکلاتی ایجاد کنه.
  </Alert>

  <div className="grid md:grid-cols-2 gap-4">

    <div className="space-y-2">

**❌ قبل (Marzban)**
```yaml
services:
  marzban:
    image: gozargah/marzban:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/marzban:/var/lib/marzban
    depends_on:
      - mysql

  mysql:
    image: mysql:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --mysqlx-bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: marzban
    volumes:
      - /var/lib/mysql/marzban:/var/lib/mysql
```

</div>

<div className="space-y-2">

**✅ بعد (PasarGuard)**
```yaml
services:
  pasarguard:
    image: pasarguard/panel:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/pasarguard:/var/lib/pasarguard
    depends_on:
      - mysql

  mysql:
    image: mysql:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --mysqlx-bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: pasarguard
    volumes:
      - /var/lib/mysql/pasarguard:/var/lib/mysql
```

</div>

</div>

  </Accordion>

  <Accordion title="MariaDB">
  <Alert type="warning">
    ⚠️ **توجه**: اگه از قبل از ایمیج `mariadb:latest` استفاده می‌کنید، اون رو به ایمیج `mariadb:lts` تغییر ندید، چون گاهی ممکنه مشکلاتی ایجاد کنه.
  </Alert>

  <div className="grid md:grid-cols-2 gap-4">

    <div className="space-y-2">

**❌ قبل (Marzban)**
```yaml
services:
  marzban:
    image: gozargah/marzban:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/marzban:/var/lib/marzban
    depends_on:
      - mariadb

  mariadb:
    image: mariadb:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: marzban
    volumes:
      - /var/lib/mysql/marzban:/var/lib/mysql
```

</div>

<div className="space-y-2">

**✅ بعد (PasarGuard)**
```yaml
services:
  pasarguard:
    image: pasarguard/panel:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/pasarguard:/var/lib/pasarguard
    depends_on:
      - mariadb

  mariadb:
    image: mariadb:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: pasarguard
    volumes:
      - /var/lib/mysql/pasarguard:/var/lib/mysql
```

</div>

</div>

  </Accordion>
</Accordions>

#### خلاصه تغییرات کلیدی:

<div className="overflow-x-auto">
<table>
<thead>
<tr>
<th>بخش</th>
<th>قبل</th>
<th>بعد</th>
</tr>
</thead>
<tbody>
<tr>
<td data-label="بخش"><strong>اسم سرویس</strong></td>
<td data-label="قبل"><code>marzban</code></td>
<td data-label="بعد"><code>pasarguard</code></td>
</tr>
<tr>
<td data-label="بخش"><strong>ایمیج Docker</strong></td>
<td data-label="قبل"><code>gozargah/marzban:latest</code></td>
<td data-label="بعد"><code>pasarguard/panel:latest</code></td>
</tr>
<tr>
<td data-label="بخش"><strong>ولوم برنامه</strong></td>
<td data-label="قبل"><code>/var/lib/marzban:/var/lib/marzban</code></td>
<td data-label="بعد"><code>/var/lib/pasarguard:/var/lib/pasarguard</code></td>
</tr>
<tr>
<td data-label="بخش"><strong>دیتابیس MySQL</strong></td>
<td data-label="قبل"><code>marzban</code></td>
<td data-label="بعد"><code>pasarguard</code></td>
</tr>
<tr>
<td data-label="بخش"><strong>ولوم MySQL</strong></td>
<td data-label="قبل"><code>/var/lib/mysql/marzban:/var/lib/mysql</code></td>
<td data-label="بعد"><code>/var/lib/mysql/pasarguard:/var/lib/mysql</code></td>
</tr>
</tbody>
</table>
</div>

### 7. تغییر دیتابیس MySQL مرزبان به پاسارگارد (در صورت استفاده)

اگر از دیتابیس SQLite استفاده می‌کنید، این مرحله رو رد کنید.

اما اگر از MySQL یا MariaDB استفاده می‌کنید، باید از دیتابیس مرزبان خروجی بگیرید تا بعداً به عنوان دیتابیس پاسارگارد وارد بشه.

> ⚠️ **توجه**: تمام دستورات زیر برای مهاجرت دیتابیس باید در حالی اجرا شوند که در مسیر `/opt/pasarguard/` هستید.

#### اجرای MySQL یا MariaDB

ابتدا سرویس MySQL یا MariaDB را بسته به اینکه کدام را استفاده می‌کنید، اجرا کنید.

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
cd /opt/pasarguard && docker compose up -d mysql
```
  </Tab>

  <Tab value="MariaDB">
```bash
cd /opt/pasarguard && docker compose up -d mariadb
```
  </Tab>
</Tabs>

#### گرفتن خروجی از دیتابیس
در این مرحله ازتون پسورد دیتابیس خواسته میشه. همون مقدار `MYSQL_ROOT_PASSWORD` که داخل فایل `.env` هست رو وارد کنید:

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
docker compose exec mysql mysqldump -u root -p -h 127.0.0.1 --databases marzban > "/opt/pasarguard/marzban.sql"
```
  </Tab>

  <Tab value="MariaDB">
```bash
docker compose exec mariadb mariadb-dump -u root -p -h 127.0.0.1 --databases marzban > "/opt/pasarguard/marzban.sql"
```
  </Tab>
</Tabs>

<Alert type="info">
اگر با خطای "Access Denied" روبه‌رو شدید، به جای یوزر `root` از یوزر `marzban` به همراه پسورد `MYSQL_PASSWORD` داخل `.env` استفاده کنید:
<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
docker compose exec mysql mysqldump -u marzban -p -h 127.0.0.1 --databases marzban > "/opt/pasarguard/marzban.sql"
```
  </Tab>

  <Tab value="MariaDB">
```bash
docker compose exec mariadb mariadb-dump -u marzban -p -h 127.0.0.1 --databases marzban > "/opt/pasarguard/marzban.sql"
```
  </Tab>
</Tabs>
</Alert>

#### ویرایش اطلاعات دیتابیس

این مرحله خیلی مهمه چون باید دیتابیس pasarguard داخل MySQL ساخته بشه.
با دستور زیر اسم "marzban" به "pasarguard" توی دو خط مهم (`CREATE DATABASE` و `USE`) تغییر داده میشه:

```bash
sed -i '/^CREATE DATABASE/s/marzban/pasarguard/;/^USE/s/marzban/pasarguard/' /opt/pasarguard/marzban.sql
```

#### وارد کردن دیتابیس پاسارگارد

برای وارد کردن دیتابیس جدید، مقدار `MYSQL_ROOT_PASSWORD` که داخل `.env` هست رو در دستور زیر جایگزین کنید و اجرا کنید:

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
docker compose exec -T mysql mysql -u root -p"MYSQL_ROOT_PASSWORD" -h 127.0.0.1 < "/opt/pasarguard/marzban.sql"
```
  </Tab>

  <Tab value="MariaDB">
```bash
docker compose exec -T mariadb mariadb -u root -p"MYSQL_ROOT_PASSWORD" -h 127.0.0.1 < "/opt/pasarguard/marzban.sql"
```
  </Tab>
</Tabs>

<Callout type="warning">
این پروسه ممکنه کمی زمان ببره.
</Callout>

<Alert type="success">
اگه هیچ خروجی‌ای مشاهده نکردید، نشونه‌ی خوبی هست.
برای اطمینان از موفقیت‌آمیز بودن وارد کردن دیتابیس، دیتابیس‌های MySQL رو لیست کنید. باید `pasarguard` رو بین اونها ببینید.

قسمت `MYSQL_ROOT_PASSWORD` رو با مقدارش در فایل `.env` جایگزین کرده و دستور را اجرا کنید.

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
docker compose exec mysql mysql -u root -p"MYSQL_ROOT_PASSWORD" -e "SHOW DATABASES;"
```
  </Tab>

  <Tab value="MariaDB">
```bash
docker compose exec mariadb mariadb -u root -p"MYSQL_ROOT_PASSWORD" -e "SHOW DATABASES;"
```
  </Tab>
</Tabs>
</Alert>

اگر هنگام اجرای دستور وارد کردن دیتابیس با خطایی مواجه شدید، یعنی مشکلی پیش اومده. اطلاعات دیتابیس خودتون رو بررسی کرده و دوباره تلاش کنید.

#### حذف دیتابیس Marzban

از اونجایی که دیگه به دیتابیس Marzban نیاز نداریم، می‌تونیم حذفش کنیم.
برای حذف دیتابیس Marzban، دستور زیر رو اجرا کنید و دوباره پسورد رو وارد کنید (مقدار `MYSQL_ROOT_PASSWORD` در `.env`):

<Alert type="error">
⚠️ **هشدار**:
دستورات زیر دیتابیس Marzban رو حذف می‌کنن.  
حتماً یه بکاپ کامل از دیتاتون داشته باشید و آماده باشید اگه مشکلی پیش اومد، بتونید دیتا رو برگردونید.
</Alert>

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
rm /opt/pasarguard/marzban.sql
docker compose exec mysql mysql -u root -p -e "DROP DATABASE marzban;"
```
  </Tab>

  <Tab value="MariaDB">
```bash
rm /opt/pasarguard/marzban.sql
docker compose exec mariadb mariadb -u root -p -e "DROP DATABASE marzban;"
```
  </Tab>
</Tabs>

### 8. اسکریپت مدیریت پاسارگارد رو نصب کنید

اسکریپت مدیریت پاسارگارد رو برای مدیریت راحت‌تر نصب کنید:

#### دستور نصب اسکریپت

```bash
sudo bash -c "$(curl -sL https://github.com/PasarGuard/scripts/raw/main/pasarguard.sh)" @ install-script
```

این اسکریپت دستورات کاربردی برای مدیریت نصب پاسارگارد بهتون میده.

### 9. پاسارگارد رو راه‌اندازی کنید

حالا پاسارگارد رو با تنظیمات جدید راه‌اندازی کنید:

#### دستور راه‌اندازی

```bash
pasarguard restart
```

### 10. مهاجرت رو بررسی کنید

چک کنید که همه سرویس‌ها درست کار می‌کنن:

#### دستورات بررسی

```bash
pasarguard status
```

آدرس پنلتون رو باز کنید تا مطمئن شید همه چی اوکیه.

## مراحل مهاجرت: نصب جدید

<Callout type="info"> 
💬 **توجه**:

در این روش مهاجرت، تنظیمات قبلی شما در فایل `.env` به پاسارگارد منتقل نمی‌شن و باید خودتون اونها رو به صورت دستی پیکربندی کنید.

می‌تونید تمام متغیرهای قابل تنظیم داخل فایل `.env` رو بررسی کنید، یا برای جزئیات بیشتر به [مستندات پیکربندی پنل](/fa/panel/configuration/) مراجعه کنید.

برخی از تنظیمات مثل ربات تلگرام، پیشوند URL لینک اشتراک و بقیه موارد، حالا مستقیماً از تنظیمات داشبورد قابل مدیریت هستند.
</Callout>

### 1. نصب پاسارگارد

ابتدا پاسارگارد رو روی سرور جدیدتون با توجه به دیتابیس فعلی‌تون نصب کنید، همون‌طور که در [مستندات نصب پنل](/fa/panel/installation/) توضیح داده شده.  
حتماً دستورالعمل‌ها و توضیحات رو با دقت مرور کنید.

### 2. گواهی SSL

برای دسترسی امن به داشبورد، باید SSL رو روی پاسارگارد فعال کنید.  
فایل‌های گواهی SSL تون رو روی سرور آپلود کنید و در مسیر `/var/lib/pasarguard/certs/` قرار بدید.  
اگه هنوز گواهی SSL ندارین، می‌تونید یکی دریافت کنید. [مستندات فعال‌سازی SSL](/fa/learn/ssl-activation-cli/) رو بررسی کنید. 

وقتی گواهی SSL آماده شد، اون رو در فایل `.env` با استفاده از متغیرهای `UVICORN_SSL` فعال کنید.

```bash
pasarguard edit-env
```

### 3. آپلود دیتابیس

حالا شما باید دیتابیس رو روی سرور خودتون آپلود کنید. روش کار بستگی داره به اینکه از کدوم دیتابیس استفاده می‌کنید.

#### وارد کردن دیتابیس SQLite

- کافیه فایل `db.sqlite3` مربوط به Marzban رو داخل مسیر `/var/lib/pasarguard/` قرار بدید. تمام.

#### وارد کردن دیتابیس MySQL یا MariaDB

اگه از دیتابیس MySQL یا MariaDB استفاده می‌کنید، باید دیتابیس رو با استفاده از برنامه **phpMyAdmin** وارد کنید. این مراحل رو با دقت دنبال کنید:

- ویرایش فایل دیتابیس:

باید فایل دیتابیس MySQL یا MariaDB خودتون رو ویرایش کنید.  
فایل `marzban.sql` مربوط به بکاپ مرزبان رو با یک ویرایشگر متن باز کنید.  
در این دو خط مشخص شده، `marzban` رو با `pasarguard`  مثل تصویر جایگزین کنید، و فایل رو ذخیره کنید.

<Callout type="tip">
اگر این دو خط در فایل‌تون وجود ندارند، به مرحله بعدی برید.
</Callout>

<div className="grid md:grid-cols-2 gap-4">

<div className="space-y-2">
**❌ قبل**
<img 
  src="/images/migration/edit-mysql-database-1.png" 
  alt="Edit MySQL Database 1" 
  width="900"
/>
</div>

<div className="space-y-2">
**✅ بعد**
<img 
  src="/images/migration/edit-mysql-database-2.png" 
  alt="Edit MySQL Database 2" 
  width="900"
/>
</div>

</div>

- ورود به **phpMyAdmin**:

شما می‌تونید به **phpMyAdmin** از طریق مرورگر روی آدرس `http://YOUR_SERVER_IP:8010` دسترسی پیدا کنید. 
با کاربر `root` و مقدار `MYSQL_ROOT_PASSWORD` که در فایل `.env` هست وارد بشید.

- حذف جدول‌ها:

جدول‌های موجود رو طبق تصویری که نشون داده شده حذف کنید:

<img 
  src="/images/migration/drop-mysql-tables.png" 
  alt="Drop MySQL Tables" 
  width="500" 
  height="300"
/>

- وارد کردن دیتابیس:

حالا به تب "Import" در **phpMyAdmin** برید. فایل `marzban.sql` خودتون رو در بخش "Choose File" انتخاب کنید و بعد روی دکمه Import کلیک کنید.

### 4. راه‌اندازی مجدد PasarGuard

در نهایت، PasarGuard رو ری‌استارت کنید:

```bash
pasarguard restart
```

## عیب‌یابی

### مشکلات رایج

> 💡 **نکته**: بیشتر مشکلات با بررسی دسترسی‌های فایل و تنظیمات مسیرها حل میشن.

**1. اجازه دسترسی ندارید (Permission Denied)**:
مطمئن شید که دستورات رو با دسترسی‌های مناسب (sudo در صورت نیاز) اجرا می‌کنید.

**2. مشکلات اتصال به دیتابیس**:
اگه از MySQL استفاده می‌کنید، چک کنید که مسیرهای دیتابیس و اطلاعات ورود درست به‌روز شده باشن.

**3. تداخل پورت‌ها**:
مطمئن شید که هیچ سرویس دیگه‌ای از همون پورت‌ها استفاده نمی‌کنه.

**4. متغیرهای محیطی گم شده**:
دوباره چک کنید که همه متغیرهای محیطی تو فایل `.env` درست به‌روز شده باشن.

### برگشت به نسخه قبل

> ⚠️ **بازگشت اضطراری**: اگه با مشکلات جدی مواجه شدید و نیاز به بازگشت به نسخه قبل دارید

```bash
# پاسارگارد رو متوقف کنید
cd /opt/pasarguard
docker compose down

# پوشه‌های اصلی رو برگردونید
sudo mv /opt/pasarguard /opt/marzban
sudo mv /var/lib/pasarguard /var/lib/marzban
sudo mv /var/lib/mysql/pasarguard /var/lib/mysql/marzban  # اگه استفاده می‌کنید

# فایل‌های docker-compose.yml و .env اصلی رو از بک‌آپ برگردونید
# بعد Marzban رو راه‌اندازی کنید
marzban up
```

## بعد از مهاجرت

بعد از مهاجرت موفق:

- **📡 نودهای پاسارگارد**: نودهای پاسارگارد رو نصب و متصل کنید. خود پاسارگارد به‌تنهایی Xray-Core رو اجرا نمی‌کنه.
- **📊 مانیتورینگ رو به‌روز کنید**: اگه ابزارهای مانیتورینگ دارید، اون‌ها رو به مسیرهای جدید متصل کنید.
- **💾 بک‌آپ‌ها رو به‌روز کنید**: مطمئن شید که اسکریپت‌های بک‌آپتون برای بک‌آپ گرفتن از پوشه‌های جدید به‌روز شدن.
- **🧪 همه قابلیت‌ها رو تست کنید**: همه قابلیت‌های پنل رو کامل تست کنید تا مطمئن شید همه چی درست کار می‌کنه.

## پشتیبانی

🔗 **لینک‌ها**

- **گروه بحث و گفتگو**: [Telegram](https://t.me/PasarGuardGP)
- **مشکلات**: اگه تو طول مهاجرت به مشکلی برخوردید، یه issue بسازید.

---

> **📝 نکته**: این راهنما فرض رو بر این میذاره که نصب Marzban استاندارد بوده. تنظیمات شخصی ممکنه نیاز به مراحل اضافی داشته باشن.
