---
title: Marzban åˆ° PasarGuard
icon: ArrowRightLeft
---

<Alert type="warning">
æœ¬æŒ‡å—é€‚ç”¨äº Marzban beta-3 åŠä»¥ä¸‹ç‰ˆæœ¬ã€‚
</Alert>

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°†æ•°æ®ã€è®¾ç½®å’Œç”¨æˆ·å¸æˆ·ä» Marzban è¿ç§»åˆ° PasarGuardï¼Œä¸”ä¸ä¼šä¸¢å¤±ä»»ä½•å†…å®¹ã€‚

è§£é‡Šäº†ä¸¤ç§è¿ç§»æ–¹æ³•ã€‚æ‚¨å¯ä»¥é€‰æ‹©æ‚¨æ›´èˆ’æœçš„ä¸€ä¸ªã€‚

- [ä»ç°æœ‰ Marzban å®‰è£…è¿ç§»](/zh/migration/marzban/#è¿ç§»æ­¥éª¤å½“å‰å®‰è£…)

ä¿ç•™æ‰€æœ‰ç°æœ‰è®¾ç½®å’Œæ–‡ä»¶ã€‚ä¸éœ€è¦æ–°æœåŠ¡å™¨ã€‚ä½†ç¨å¾®å¤æ‚ä¸€äº›ï¼Œæ¶‰åŠæ›´å¤šå‘½ä»¤ã€‚

- [é€šè¿‡å…¨æ–° PasarGuard å®‰è£…è¿›è¡Œè¿ç§»](/zh/migration/marzban/#è¿ç§»æ­¥éª¤å…¨æ–°å®‰è£…)

æ›´ç®€å•ã€æ›´å¿«ï¼Œå‘½ä»¤æ›´å°‘ã€‚ä½†éœ€è¦æ–°çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”è¿ç§»åéœ€è¦æ‰‹åŠ¨é…ç½®ä¸€äº›è®¾ç½®ã€‚

## å…ˆå†³æ¡ä»¶

> âš ï¸ **é‡è¦**ï¼šåœ¨å¼€å§‹è¿ç§»è¿‡ç¨‹ä¹‹å‰ï¼Œè¯·åŠ¡å¿…å®Œæ•´å¤‡ä»½æ‚¨çš„æ•°æ®ã€‚

- ç¡®ä¿æ‚¨æ‹¥æœ‰æœåŠ¡å™¨çš„ root æƒé™ã€‚
- å¤‡ä»½æ‚¨å½“å‰çš„ Marzban å®‰è£…ã€‚
- æ£€æŸ¥ Docker å’Œ Docker Compose æ˜¯å¦å·²å®‰è£…ã€‚

## è¿ç§»æ­¥éª¤ï¼šå½“å‰å®‰è£…

### 1. åœæ­¢ Marzban æœåŠ¡

é¦–å…ˆï¼Œåœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Marzban å®¹å™¨ï¼š

#### åœæ­¢æœåŠ¡å‘½ä»¤

```bash
cd /opt/marzban
docker compose down
```

### 2. é‡å‘½åä¸»ç›®å½•

å¦‚æœ PasarGuard ç›®å½•å·²å­˜åœ¨ï¼Œè¯·åˆ é™¤å®ƒä»¬ï¼š

#### ç›®å½•åˆ é™¤å‘½ä»¤

```bash
rm -r /opt/pasarguard /var/lib/pasarguard /var/lib/mysql/pasarguard
```

å°† Marzban ä¸»ç›®å½•åç§°æ›´æ”¹ä¸º PasarGuardï¼š

#### ç›®å½•é‡å‘½åå‘½ä»¤

```bash
sudo mv /opt/marzban /opt/pasarguard
```

### 3. é‡å‘½åæ•°æ®ç›®å½•

åŒæ—¶æ›´æ”¹æ•°æ®ç›®å½•åç§°ï¼š

#### æ•°æ®ç›®å½•é‡å‘½åå‘½ä»¤

```bash
sudo mv /var/lib/marzban /var/lib/pasarguard
```

### 4. é‡å‘½å MySQL ç›®å½•ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ MySQL æˆ– MariaDBï¼Œå¹¶ä¸”æœ‰ä¸“é—¨ç”¨äº Marzban æ•°æ®åº“çš„ç›®å½•ï¼š

#### MySQL ç›®å½•é‡å‘½åå‘½ä»¤

```bash
sudo mv /var/lib/mysql/marzban /var/lib/mysql/pasarguard
```

<Alert type="info">
å¦‚æœæ‚¨é‡åˆ°â€œæ— æ­¤æ–‡ä»¶æˆ–ç›®å½•â€é”™è¯¯ï¼Œå¯èƒ½æ˜¯å› ä¸º MySQL ç›®å½•ä¸åŒã€‚è¯·æ”¹ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```bash
mkdir -p /var/lib/mysql/pasarguard
mv /var/lib/pasarguard/mysql/* /var/lib/mysql/pasarguard
rm -r /var/lib/pasarguard/mysql
```
</Alert>

### 5. æ›´æ–°ç¯å¢ƒå˜é‡

è¿›å…¥æ–°çš„ PasarGuard ç›®å½•å¹¶æ›´æ–°ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š

```bash
cd /opt/pasarguard
```

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ›´æ–° `.env` æ–‡ä»¶ä¸­å¼•ç”¨çš„æ‰€æœ‰è·¯å¾„ï¼š

```bash
sudo sed -i 's|/var/lib/marzban|/var/lib/pasarguard|g' .env
```

<Alert type="warning">
å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬ï¼ˆ0.8.4 æˆ–æ›´ä½ç‰ˆæœ¬ï¼‰ï¼Œåˆ™è¿˜éœ€è¦æ›´æ”¹ SQL é©±åŠ¨ç¨‹åºï¼š
</Alert>

æ‰“å¼€ `.env` æ–‡ä»¶æ–‡ä»¶ï¼š

```bash
nano.env
```

<Tabs items={['SQLite', 'MySQL']}>
  <Tab value="SQLite">
    ### SQLite é©±åŠ¨ç¨‹åºæ›´æ–°

    âŒ æ—§ç‰ˆæœ¬
    ```dotenv
    SQLALCHEMY_DATABASE_URL = "sqlite:////var/lib/marzban/db.sqlite3"
    ```
    âœ… æ–°ç‰ˆæœ¬
    ```dotenv
    SQLALCHEMY_DATABASE_URL = "sqlite+aiosqlite:////var/lib/pasarguard/db.sqlite3"
    ```
  </Tab>
  <Tab value="MySQL">
    ### MySQL é©±åŠ¨ç¨‹åºæ›´æ–°
    å¯¹äº MariaDBï¼Œè¯·éµå¾ªä¸ MySQL ç›¸åŒçš„æ­¥éª¤ã€‚
    > âš ï¸ **è­¦å‘Š**ï¼šåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ`MYSQL_ROOT_PASSWORD` åº”æ›¿æ¢ä¸º `.env` æ–‡ä»¶ä¸­çš„å€¼ã€‚

    âŒ æ—§ç‰ˆæœ¬
    ```dotenv
    SQLALCHEMY_DATABASE_URL = "mysql+pymysql://root:MYSQL_ROOT_PASSWORD@127.0.0.1/marzban"
    ```
    âœ… æ–°ç‰ˆæœ¬
    ```dotenv
    SQLALCHEMY_DATABASE_URL = "mysql+asyncmy://root:MYSQL_ROOT_PASSWORD@127.0.0.1/pasarguard"
    ```
  </Tab>
</Tabs>

### å…¶ä»–å˜æ›´

å¦‚æœæ‚¨åœ¨ `.env` æ–‡ä»¶ä¸­ä½¿ç”¨äº† `V2RAY_SUBSCRIPTION_TEMPLATE` æˆ–é…ç½®äº† `TLS Inbound`ï¼Œåˆ™éœ€è¦æ›´æ–°å®ƒä»¬ï¼›å¦åˆ™ï¼Œæ‚¨å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚

#### å°† v2ray ç›®å½•é‡å‘½åä¸º xray ç›®å½•å‘½ä»¤

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°† v2ray ç›®å½•æ›´æ”¹ä¸º xrayï¼š

```bash
mv /var/lib/pasarguard/templates/v2ray /var/lib/pasarguard/templates/xray
```

#### æ›´æ–° xray-config è¯ä¹¦ç›®å½•

åœ¨ `xray_config.json` æ–‡ä»¶ä¸­ï¼Œå°†è¯ä¹¦ç›®å½•ä» marzban æ›´æ–°ä¸º pasarguardï¼š

```bash
nano /var/lib/pasarguard/xray_config.json
```

æ›´æ”¹åï¼Œæ‚¨çš„ `.env` æ–‡ä»¶å’Œ `xray_config.json` åº”å¦‚ä¸‹æ‰€ç¤ºï¼š

<Tabs items={['XRAY_SUBSCRIPTION_TEMPLATE', 'Xray-Config Certificate Directories']}>
  <Tab value="XRAY_SUBSCRIPTION_TEMPLATE">
    ### æ›´æ–° `.env` æ–‡ä»¶ä¸­çš„ Xray è®¢é˜…æ¨¡æ¿

    âŒ æ—§ç‰ˆæœ¬
    ```dotenv
    V2RAY_SUBSCRIPTION_TEMPLATE = "v2ray/default.json"
    ```
    âœ… å…¨æ–°ç‰ˆæœ¬
    ```dotenv
    XRAY_SUBSCRIPTION_TEMPLATE = "xray/default.json"
    ```
  </Tab>

  <Tab value="Xray-Config Certificate Directories">
    ### æ›´æ–° `xray_config.json` ä¸­çš„è¯ä¹¦ç›®å½•

âŒ æ—§ç‰ˆæœ¬
    ```json
          "certificates": [
            {
              "certificateFile": "/var/lib/marzban/certs/example.com/fullchain.pem",
              "keyFile": "/var/lib/marzban/certs/example.com/key.pem"
            }
          ],
    ```
âœ… å…¨æ–°ç‰ˆæœ¬
    ```json
          "certificates": [
            {
              "certificateFile": "/var/lib/pasarguard/certs/example.com/fullchain.pem",
              "keyFile": "/var/lib/pasarguard/certs/example.com/key.pem"
            }
          ],
    ```
  </Tab>
</Tabs>

### 6. æ›´æ–° Docker Compose æ–‡ä»¶

æ›´æ–° `docker-compose.yml` æ–‡ä»¶ä»¥åæ˜ æ–°è·¯å¾„ã€‚æ‚¨éœ€è¦æ‰‹åŠ¨ç¼–è¾‘æ­¤æ–‡ä»¶ï¼š

```bash
sudo nano docker-compose.yml
```

#### Docker Compose æ›´æ”¹

ä»¥ä¸‹æ˜¯æ¯ä¸ªæ•°æ®åº“æ‰€éœ€æ›´æ”¹çš„æ¯”è¾ƒï¼š

<Accordions type="multiple">
  <Accordion title="SQLite">
<div className="grid md:grid-cols-2 gap-4">

<div className="space-y-2">

**âŒ ä¿®æ”¹å‰ (Marzban)**
```yaml
services:
  marzban:
    image: gozargah/marzban:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/marzban:/var/lib/marzban
```

</div>

<div className="space-y-2">

**âœ… ä¿®æ”¹å (PasarGuard)**
```yaml
services:
  pasarguard:
    image: pasarguard/panel:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/pasarguard:/var/lib/pasarguard
```

</div>

</div>

</Accordion>

<Accordion title="MySQL">
  <Alert type="warning">
    âš ï¸ **è­¦å‘Š**ï¼šå¦‚æœæ‚¨å·²ç»åœ¨ä½¿ç”¨ `mysql:latest` é•œåƒï¼Œè¯·å‹¿å°†å…¶æ›´æ”¹ä¸º `mysql:lts` é•œåƒï¼Œå› ä¸ºè¿™æœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚
  </Alert>

  <div className="grid md:grid-cols-2 gap-4">

    <div className="space-y-2">

**âŒ ä¹‹å‰ (Marzban)**
```yaml
services:
  marzban:
    image: gozargah/marzban:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/marzban:/var/lib/marzban
    depends_on:
      - mysql

  mysql:
    image: mysql:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --mysqlx-bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: marzban
    volumes:
      - /var/lib/mysql/marzban:/var/lib/mysql
```

</div>

<div className="space-y-2">

**âœ… ä¿®æ”¹å (PasarGuard)**
```yaml
services:
  pasarguard:
    image: pasarguard/panel:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/pasarguard:/var/lib/pasarguard
    depends_on:
      - mysql

  mysql:
    image: mysql:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --mysqlx-bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: pasarguard
    volumes:
      - /var/lib/mysql/pasarguard:/var/lib/mysql
```

</div>

</div>

  </Accordion>

  <Accordion title="MariaDB">
  <Alert type="warning">
    âš ï¸ **è­¦å‘Š**ï¼šå¦‚æœæ‚¨å·²ç»åœ¨ä½¿ç”¨ `mariadb:latest` é•œåƒï¼Œè¯·å‹¿å°†å…¶æ›´æ”¹ä¸º `mariadb:lts` é•œåƒï¼Œå› ä¸ºè¿™æœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚
  </Alert>

  <div className="grid md:grid-cols-2 gap-4">

    <div className="space-y-2">

**âŒ ä¹‹å‰ (Marzban)**
```yaml
services:
  marzban:
    image: gozargah/marzban:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/marzban:/var/lib/marzban
    depends_on:
      - mariadb

  mariadb:
    image: mariadb:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: marzban
    volumes:
      - /var/lib/mysql/marzban:/var/lib/mysql
```

</div>

<div className="space-y-2">

**âœ… ä¿®æ”¹å (PasarGuard)**
```yaml
services:
  pasarguard:
    image: pasarguard/panel:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/pasarguard:/var/lib/pasarguard
    depends_on:
      - mariadb

  mariadb:
    image: mariadb:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: pasarguard
    volumes:
      - /var/lib/mysql/pasarguard:/var/lib/mysql
```

</div>

</div>

  </Accordion>
</Accordions>

#### å…³é”®æ›´æ”¹æ‘˜è¦ï¼š

<div className="overflow-x-auto">
<table>
<thead>
<tr>
<th>éƒ¨åˆ†</th>
<th>ä¹‹å‰</th>
<th>ä¹‹å</th>
</tr>
</thead>
<tbody>
<tr>
<td data-label="éƒ¨åˆ†"><strong>æœåŠ¡åç§°</strong></td>
<td data-label="ä¹‹å‰"><code>marzban</code></td>
<td data-label="ä¹‹å"><code>pasarguard</code></td>
</tr>
<tr>
<td data-label="éƒ¨åˆ†"><strong>Docker é•œåƒ</strong></td>
<td data-label="ä¹‹å‰"><code>gozargah/marzban:latest</code></td>
<td data-label="ä¹‹å"><code>pasarguard/panel:latest</code></td>
</tr>
<tr>
<td data-label="éƒ¨åˆ†"><strong>åº”ç”¨å·</strong></td>
<td data-label="ä¹‹å‰"><code>/var/lib/marzban:/var/lib/marzban</code></td>
<td data-label="ä¹‹å"><code>/var/lib/pasarguard:/var/lib/pasarguard</code></td>
</tr>
<tr>
<td data-label="éƒ¨åˆ†"><strong>MySQL æ•°æ®åº“</strong></td>
<td data-label="ä¹‹å‰"><code>marzban</code></td>
<td data-label="ä¹‹å"><code>pasarguard</code></td>
</tr>
<tr>
<td data-label="éƒ¨åˆ†"><strong>MySQL å·</strong></td>
<td data-label="ä¹‹å‰"><code>/var/lib/mysql/marzban:/var/lib/mysql</code></td>
<td data-label="ä¹‹å"><code>/var/lib/mysql/pasarguard:/var/lib/mysql</code></td>
</tr>
</tbody>
</table>
</div>

### 7. å°† Marzban MySQL æ•°æ®åº“æ›´æ”¹ä¸º PasarGuardï¼ˆå¦‚æœä½¿ç”¨ï¼‰

å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ SQLite æ•°æ®åº“ï¼Œè¯·è·³è¿‡æ­¤æ­¥éª¤ã€‚

å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ MySQL æˆ– MariaDB æ•°æ®åº“ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯¼å‡º Marzban æ•°æ®åº“ï¼Œä»¥ä¾¿ç¨åå°†å…¶å¯¼å…¥ä¸º PasarGuard æ•°æ®åº“ã€‚

> âš ï¸ **æ³¨æ„**ï¼šæ‰€æœ‰ä»¥ä¸‹æ•°æ®åº“è¿ç§»å‘½ä»¤éƒ½åº”åœ¨ `/opt/pasarguard/` ç›®å½•ä¸­æ‰§è¡Œã€‚

#### å¯åŠ¨ MySQL æˆ– MariaDB

é¦–å…ˆï¼Œæ ¹æ®æ‚¨ä½¿ç”¨çš„ MySQL æˆ– MariaDB æœåŠ¡å¯åŠ¨ç›¸åº”çš„æœåŠ¡ã€‚

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
cd /opt/pasarguard && docker compose up -d mysql
```
  </Tab>

  <Tab value="MariaDB">
```bash
cd /opt/pasarguard && docker compose up -d mariadb
```
  </Tab>
</Tabs>

#### å¯¼å‡ºæ•°æ®åº“
å¯¼å‡º Marzban æ•°æ®åº“ã€‚ç³»ç»Ÿå°†æç¤ºæ‚¨è¾“å…¥æ•°æ®åº“å¯†ç â€”â€”è¯·ä½¿ç”¨ `.env` æ–‡ä»¶ä¸­ `MYSQL_ROOT_PASSWORD` çš„å€¼ã€‚

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
docker compose exec mysql mysqldump -u root -p -h 127.0.0.1 --databases marzban > "/opt/pasarguard/marzban.sql"
```
  </Tab>

  <Tab value="MariaDB">
```bash
docker compose exec mariadb mariadb-dump -u root -p -h 127.0.0.1 --databases marzban > "/opt/pasarguard/marzban.sql"
```
  </Tab>
</Tabs>

<Alert type="info">
å¦‚æœæ‚¨é‡åˆ°â€œè®¿é—®è¢«æ‹’ç»â€é”™è¯¯ï¼Œè¯·å°è¯•ä½¿ç”¨â€œmarzbanâ€ç”¨æˆ·å¹¶ä½¿ç”¨`.env`æ–‡ä»¶ä¸­çš„â€œMYSQL_PASSWORDâ€å€¼ï¼š
<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
docker compose exec mysql mysqldump -u marzban -p -h 127.0.0.1 --databases marzban > "/opt/pasarguard/marzban.sql"
```
  </Tab>

  <Tab value="MariaDB">
```bash
docker compose exec mariadb mariadb-dump -u marzban -p -h 127.0.0.1 --databases marzban > "/opt/pasarguard/marzban.sql"
```
  </Tab>
</Tabs>
</Alert>

#### ç¼–è¾‘æ•°æ®åº“ä¿¡æ¯

æ­¤æ­¥éª¤å¯¹äºç¡®ä¿åœ¨ MySQL ä¸­åˆ›å»º pasarguard æ•°æ®åº“è‡³å…³é‡è¦ã€‚
ä»¥ä¸‹å‘½ä»¤å°†åœ¨ä¸¤è¡Œé‡è¦å†…å®¹ä¸­å°†â€œmarzbanâ€æ›¿æ¢ä¸ºâ€œpasarguardâ€ï¼š

```bash
sed -i '/^CREATE DATABASE/s/marzban/pasarguard/;/^USE/s/marzban/pasarguard/' /opt/pasarguard/marzban.sql
```

#### å¯¼å…¥ PasarGuard æ•°æ®åº“

è¦å¯¼å…¥æ–°æ•°æ®åº“ï¼Œè¯·å°† `MYSQL_ROOT_PASSWORD` æ›¿æ¢ä¸º `.env` æ–‡ä»¶ä¸­çš„å€¼ï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
docker compose exec -T mysql mysql -u root -p"MYSQL_ROOT_PASSWORD" -h 127.0.0.1 < "/opt/pasarguard/marzban.sql"
```
  </Tab>

  <Tab value="MariaDB">
```bash
docker compose exec -T mariadb mariadb -u root -p"MYSQL_ROOT_PASSWORD" -h 127.0.0.1 < "/opt/pasarguard/marzban.sql"
```
  </Tab>
</Tabs>

<Callout type="warning">
æ­¤è¿‡ç¨‹å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½å®Œæˆã€‚
</Callout>

<Alert type="success">
å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°ä»»ä½•è¾“å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½å…†å¤´ã€‚
è¦éªŒè¯æ•°æ®åº“å¯¼å…¥æ˜¯å¦æˆåŠŸï¼Œè¯·åˆ—å‡º MySQL æ•°æ®åº“â€”â€”æ‚¨åº”è¯¥åœ¨å…¶ä¸­çœ‹åˆ° `pasarguard`ã€‚

å°† `MYSQL_ROOT_PASSWORD` æ›¿æ¢ä¸º `.env` æ–‡ä»¶ä¸­çš„å€¼ï¼Œç„¶åè¿è¡Œè¯¥å‘½ä»¤ã€‚

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
docker compose exec mysql mysql -u root -p"MYSQL_ROOT_PASSWORD" -e "SHOW DATABASES;"
```
  </Tab>

  <Tab value="MariaDB">
```bash
docker compose exec mariadb mariadb -u root -p"MYSQL_ROOT_PASSWORD" -e "SHOW DATABASES;"
```
  </Tab>
</Tabs>
</Alert>

å¦‚æœæ‚¨åœ¨è¿è¡Œæ•°æ®åº“å¯¼å…¥å‘½ä»¤æ—¶é‡åˆ°ä»»ä½•é”™è¯¯ï¼Œåˆ™è¡¨ç¤ºå‡ºç°äº†é—®é¢˜â€”â€”è¯·æ£€æŸ¥æ‚¨çš„æ•°æ®åº“å‡­æ®ï¼Œç„¶åé‡è¯•ã€‚

#### åˆ é™¤ Marzban æ•°æ®åº“

ç”±äºæˆ‘ä»¬ä¸å†éœ€è¦ Marzban æ•°æ®åº“ï¼Œå› æ­¤å¯ä»¥å°†å…¶åˆ é™¤ã€‚
ç³»ç»Ÿå°†æç¤ºæ‚¨è¾“å…¥æ•°æ®åº“å¯†ç â€”â€”è¯·ä½¿ç”¨ `.env` æ–‡ä»¶ä¸­ `MYSQL_ROOT_PASSWORD` çš„å€¼ã€‚

<Alert type="error">
âš ï¸ **æ³¨æ„**ï¼š
ä»¥ä¸‹å‘½ä»¤å°†åˆ é™¤ Marzban æ•°æ®åº“ã€‚
è¯·ç¡®ä¿æ‚¨å·²å®Œæ•´å¤‡ä»½æ•°æ®ï¼Œä»¥ä¾¿åœ¨å‡ºç°ä»»ä½•é—®é¢˜æ—¶è¿›è¡Œæ¢å¤ã€‚
</Alert>

<Tabs items={['MySQL', 'MariaDB']}>
  <Tab value="MySQL">
```bash
rm /opt/pasarguard/marzban.sql
docker compose exec mysql mysql -u root -p -e "DROP DATABASE marzban;"
```
  </Tab>

  <Tab value="MariaDB">
```bash
rm /opt/pasarguard/marzban.sql
docker compose exec mariadb mariadb -u root -p -e "DROP DATABASE marzban;"
```
  </Tab>
</Tabs>

### 8. å®‰è£… PasarGuard ç®¡ç†è„šæœ¬

å®‰è£… PasarGuard ç®¡ç†è„šæœ¬ä»¥ä¾¿äºç®¡ç†ï¼š

#### è„šæœ¬å®‰è£…å‘½ä»¤

```bash
curl -sL https://github.com/PasarGuard/scripts/raw/main/pasarguard.sh | sudo bash -s -- @ install-script
```

æ­¤è„šæœ¬ä¸ºç®¡ç†æ‚¨çš„ PasarGuard å®‰è£…æä¾›æœ‰ç”¨çš„å‘½ä»¤ã€‚

### 9. å¯åŠ¨ PasarGuard

ç°åœ¨ä½¿ç”¨æ–°é…ç½®å¯åŠ¨ PasarGuardï¼š

#### å¯åŠ¨å‘½ä»¤

```bash
pasarguard restart
```

### 10. éªŒè¯è¿ç§»

æ£€æŸ¥æ‰€æœ‰æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

#### éªŒè¯å‘½ä»¤

```bash
pasarguard status
```

æ‰“å¼€æ‚¨çš„é¢æ¿ URL ä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸å·¥ä½œã€‚

## è¿ç§»æ­¥éª¤ï¼šå…¨æ–°å®‰è£…

<Callout type="info">
ğŸ’¬ **æ³¨æ„**ï¼š

åœ¨æ­¤è¿ç§»æ–¹æ³•ä¸­ï¼Œæ‚¨ä¹‹å‰åœ¨ `.env` æ–‡ä»¶ä¸­çš„è®¾ç½®å°†ä¸ä¼šè¿ç§»åˆ° PasarGuardï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨é…ç½®ã€‚

æ‚¨å¯ä»¥æŸ¥çœ‹ `.env` æ–‡ä»¶ä¸­æ‰€æœ‰å¯é…ç½®å˜é‡ï¼Œæˆ–å‚é˜… [é¢æ¿é…ç½®æ–‡æ¡£](/zh/panel/configuration/) äº†è§£æ›´å¤šè¯¦æƒ…ã€‚

æŸäº›è®¾ç½®ï¼ˆä¾‹å¦‚ Telegram æœºå™¨äººã€è®¢é˜… URL å‰ç¼€ç­‰ï¼‰ç°åœ¨å¯ä»¥ç›´æ¥ä»ä»ªè¡¨æ¿è®¾ç½®ä¸­è¿›è¡Œé…ç½®ã€‚
</Callout>

### 1. å®‰è£… PasarGuard

é¦–å…ˆï¼Œä½¿ç”¨ä¸å½“å‰æ•°æ®åº“å¯¹åº”çš„å‘½ä»¤åœ¨æ–°æœåŠ¡å™¨ä¸Šå®‰è£… PasarGuardï¼Œå…·ä½“æ“ä½œè¯·å‚è§ [Panel å®‰è£…æ–‡æ¡£](/zh/panel/installation/)ã€‚
è¯·åŠ¡å¿…ä»”ç»†é˜…è¯»ç›¸å…³è¯´æ˜ã€‚

### 2. SSL è®¤è¯

æ‚¨éœ€è¦åœ¨ PasarGuard ä¸Šå¯ç”¨ SSL æ‰èƒ½å®‰å…¨åœ°è®¿é—®ä»ªè¡¨æ¿ã€‚  
è¯·å°†æ‚¨çš„ SSL è¯ä¹¦æ–‡ä»¶ä¸Šä¼ åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼Œå¹¶å°†å…¶æ”¾ç½®åœ¨ `/var/lib/pasarguard/certs/` ç›®å½•ä¸­ã€‚  
å¦‚æœæ‚¨è¿˜æ²¡æœ‰ SSL è¯ä¹¦ï¼Œæ‚¨å¯ä»¥ç”³è¯·ä¸€ä¸ªâ€”â€”è¯·å‚é˜… [SSL æ¿€æ´»æ–‡æ¡£](/zh/learn/ssl-activation-cli/)ã€‚

SSL è¯ä¹¦å‡†å¤‡å°±ç»ªåï¼Œè¯·åœ¨ `.env` æ–‡ä»¶ä¸­ä½¿ç”¨ UVICORN_SSL å˜é‡å¯ç”¨å®ƒã€‚

```bash
pasarguard edit-env
```

### 3. ä¸Šä¼ æ•°æ®åº“

ç°åœ¨ï¼Œæ‚¨éœ€è¦å°†æ•°æ®åº“ä¸Šä¼ åˆ°æ‚¨çš„æœåŠ¡å™¨ã€‚å…·ä½“æ­¥éª¤å–å†³äºæ‚¨ä½¿ç”¨çš„æ•°æ®åº“ã€‚

#### å¯¼å…¥ SQLite æ•°æ®åº“

- åªéœ€å°† Marzban ä¸­çš„ `db.sqlite3` æ–‡ä»¶æ”¾å…¥ `/var/lib/pasarguard/` ç›®å½•å³å¯ã€‚

#### å¯¼å…¥ MySQL æˆ– MariaDB æ•°æ®åº“

å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ MySQL æˆ– MariaDB æ•°æ®åº“ï¼Œåˆ™éœ€è¦ä½¿ç”¨ **phpMyAdmin** åº”ç”¨ç¨‹åºå¯¼å…¥æ•°æ®åº“ã€‚è¯·ä»”ç»†éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

- ç¼–è¾‘æ•°æ®åº“æ–‡ä»¶ï¼š

æ‚¨éœ€è¦ç¼–è¾‘ MySQL æˆ– MariaDB æ•°æ®åº“æ–‡ä»¶ã€‚
ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ Marzban å¤‡ä»½ä¸­çš„ `marzban.sql` æ–‡ä»¶ã€‚
æŒ‰ç…§å›¾ä¸­æ‰€ç¤ºï¼Œå°†è¿™ä¸¤è¡Œä¸­çš„ `marzban` æ›¿æ¢ä¸º `pasarguard`ï¼Œç„¶åä¿å­˜æ–‡ä»¶ã€‚

<Callout type="tip">
å¦‚æœæ‚¨çš„æ–‡ä»¶ä¸­æ²¡æœ‰è¿™ä¸¤è¡Œï¼Œè¯·ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚
</Callout>

<div className="grid md:grid-cols-2 gap-4">

<div className="space-y-2">
**âŒ ä¹‹å‰**
<img 
  src="/images/migration/edit-mysql-database-1.png" 
  alt="Edit MySQL Database 1" 
  width="900"
/>
</div>

<div className="space-y-2">
**âœ… ä¿®æ”¹å**
<img 
  src="/images/migration/edit-mysql-database-2.png" 
  alt="Edit MySQL Database 2" 
  width="900"
/>
</div>

</div>

- æ‰“å¼€ **phpMyAdmin**ï¼š

æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­é€šè¿‡ http://YOUR_SERVER_IP:8010 è®¿é—® **phpMyAdmin**ã€‚
ä½¿ç”¨ `root` ç”¨æˆ·å’Œ `.env` æ–‡ä»¶ä¸­çš„ `MYSQL_ROOT_PASSWORD` å€¼ç™»å½•ã€‚

- åˆ é™¤è¡¨ï¼š

å¦‚å›¾æ‰€ç¤ºï¼Œåˆ é™¤ç°æœ‰è¡¨ï¼š

<img 
  src="/images/migration/drop-mysql-tables.png" 
  alt="Drop MySQL Tables" 
  width="500" 
  height="300"
/>

- å¯¼å…¥æ•°æ®åº“ï¼š

ç°åœ¨ï¼Œåœ¨ **phpMyAdmin** ä¸­å¯¼èˆªåˆ°â€œå¯¼å…¥â€é€‰é¡¹å¡ã€‚åœ¨â€œé€‰æ‹©æ–‡ä»¶â€éƒ¨åˆ†ä¸­é€‰æ‹©æ‚¨çš„ `marzban.sql` æ–‡ä»¶ï¼Œç„¶åç‚¹å‡»â€œå¯¼å…¥â€æŒ‰é’®ã€‚

### 4. é‡å¯ PasarGuard

æœ€åï¼Œé‡å¯ PasarGuardï¼š

```bash
pasarguard restart
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

> ğŸ’¡ **æç¤º**: å¤§å¤šæ•°é—®é¢˜å¯ä»¥é€šè¿‡æ£€æŸ¥æ–‡ä»¶æƒé™å’Œè·¯å¾„é…ç½®æ¥è§£å†³ã€‚

**1. æƒé™è¢«æ‹’ç»**:
ç¡®ä¿æ‚¨ä½¿ç”¨é€‚å½“çš„æƒé™è¿è¡Œå‘½ä»¤ï¼ˆéœ€è¦æ—¶ä½¿ç”¨ sudoï¼‰ã€‚

**2. æ•°æ®åº“è¿æ¥é—®é¢˜**:
å¦‚æœæ‚¨ä½¿ç”¨ MySQLï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è·¯å¾„å’Œç™»å½•ä¿¡æ¯æ˜¯å¦æ­£ç¡®æ›´æ–°ã€‚

**3. ç«¯å£å†²çª**:
ç¡®ä¿æ²¡æœ‰å…¶ä»–æœåŠ¡ä½¿ç”¨ç›¸åŒçš„ç«¯å£ã€‚

**4. ç¼ºå°‘ç¯å¢ƒå˜é‡**:
å†æ¬¡æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„æ‰€æœ‰ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®æ›´æ–°ã€‚

### å›æ»š

> âš ï¸ **ç´§æ€¥å›æ»š**: å¦‚æœæ‚¨é‡åˆ°ä¸¥é‡é—®é¢˜å¹¶éœ€è¦æ¢å¤åˆ°ä»¥å‰ç‰ˆæœ¬

```bash
# åœæ­¢ PasarGuard
cd /opt/pasarguard
docker compose down

# æ¢å¤åŸå§‹ç›®å½•
sudo mv /opt/pasarguard /opt/marzban
sudo mv /var/lib/pasarguard /var/lib/marzban
sudo mv /var/lib/mysql/pasarguard /var/lib/mysql/marzban  # å¦‚æœä½¿ç”¨

# ä»å¤‡ä»½æ¢å¤åŸå§‹ docker-compose.yml å’Œ .env æ–‡ä»¶
# ç„¶åå¯åŠ¨ Marzban
marzban up
```

## è¿ç§»å

æˆåŠŸè¿ç§»åï¼š

- ğŸ“¡ PasarGuard èŠ‚ç‚¹ï¼šå®‰è£…å¹¶è¿æ¥ PasarGuard èŠ‚ç‚¹ã€‚PasarGuard æœ¬èº«ä¸è¿è¡Œ Xray-Coreã€‚
- **ğŸ“Š æ›´æ–°ç›‘æ§**: å¦‚æœæ‚¨æœ‰ç›‘æ§å·¥å…·ï¼Œè¯·å°†å®ƒä»¬è¿æ¥åˆ°æ–°è·¯å¾„ã€‚
- **ğŸ’¾ æ›´æ–°å¤‡ä»½**: ç¡®ä¿æ‚¨çš„å¤‡ä»½è„šæœ¬å·²æ›´æ–°ä¸ºä»æ–°ç›®å½•è¿›è¡Œå¤‡ä»½ã€‚
- **ğŸ§ª æµ‹è¯•æ‰€æœ‰åŠŸèƒ½**: å½»åº•æµ‹è¯•æ‰€æœ‰é¢æ¿åŠŸèƒ½ä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸å·¥ä½œã€‚

## æ”¯æŒ

ğŸ”— **é“¾æ¥**

- **è®¨è®ºç»„**: [Telegram](https://t.me/PasarGuardGP)
- **é—®é¢˜**: å¦‚æœæ‚¨åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·åˆ›å»º issueã€‚

---

> **ğŸ“ æ³¨æ„**: æ­¤æŒ‡å—å‡è®¾æ ‡å‡† Marzban å®‰è£…ã€‚è‡ªå®šä¹‰é…ç½®å¯èƒ½éœ€è¦é¢å¤–æ­¥éª¤ã€‚
