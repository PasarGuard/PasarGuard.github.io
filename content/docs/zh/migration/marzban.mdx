---
title: Marzban åˆ° PasarGuard
icon: ArrowRightLeft
---

<Alert type="warning">
æ­¤æŒ‡å—é€‚ç”¨äº Marzban ç‰ˆæœ¬ `beta-3` åŠä»¥ä¸‹ã€‚
</Alert>

æ­¤æŒ‡å—å°†å¸®åŠ©æ‚¨å°†æ•°æ®ã€è®¾ç½®å’Œç”¨æˆ·è´¦æˆ·ä» Marzban è¿ç§»åˆ° PasarGuardï¼Œè€Œä¸ä¼šä¸¢å¤±ä»»ä½•å†…å®¹ã€‚

## å…ˆå†³æ¡ä»¶

> âš ï¸ **é‡è¦**: åœ¨å¼€å§‹è¿ç§»è¿‡ç¨‹ä¹‹å‰ï¼Œè¯·å§‹ç»ˆå¤‡ä»½æ‚¨çš„å®Œæ•´æ•°æ®ã€‚

- ç¡®ä¿æ‚¨å¯¹æœåŠ¡å™¨å…·æœ‰ root è®¿é—®æƒé™ã€‚
- å¤‡ä»½æ‚¨å½“å‰çš„ Marzban å®‰è£…ã€‚
- æ£€æŸ¥æ˜¯å¦å®‰è£…äº† Docker å’Œ Docker Composeã€‚

## è¿ç§»æ­¥éª¤

### 1. åœæ­¢ Marzban æœåŠ¡

é¦–å…ˆï¼Œåœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Marzban å®¹å™¨ï¼š

#### åœæ­¢æœåŠ¡å‘½ä»¤

```bash
cd /opt/marzban
docker compose down
```

### 2. é‡å‘½åä¸»ç›®å½•

å°† Marzban ä¸»ç›®å½•åç§°æ›´æ”¹ä¸º PasarGuardï¼š

#### ç›®å½•é‡å‘½åå‘½ä»¤

```bash
sudo mv /opt/marzban /opt/pasarguard
```

### 3. é‡å‘½åæ•°æ®ç›®å½•

åŒæ—¶æ›´æ”¹æ•°æ®ç›®å½•åç§°ï¼š

#### æ•°æ®ç›®å½•é‡å‘½åå‘½ä»¤

```bash
sudo mv /var/lib/marzban /var/lib/pasarguard
```

### 4. é‡å‘½å MySQL ç›®å½•ï¼ˆå¦‚æœä½¿ç”¨ï¼‰

å¦‚æœæ‚¨ä½¿ç”¨ MySQL å¹¶ä¸”æœ‰ Marzban æ•°æ®åº“çš„ä¸“ç”¨ç›®å½•ï¼š

#### MySQL ç›®å½•é‡å‘½åå‘½ä»¤

```bash
sudo mv /var/lib/mysql/marzban /var/lib/mysql/pasarguard
```

### 5. æ›´æ–°ç¯å¢ƒå˜é‡

è½¬åˆ°æ–°çš„ PasarGuard ç›®å½•å¹¶æ›´æ–°ç¯å¢ƒæ–‡ä»¶ï¼š

```bash
cd /opt/pasarguard
```

ä½¿ç”¨ç®€å•å‘½ä»¤æ›´æ–° `.env` æ–‡ä»¶ä¸­å¼•ç”¨çš„æ‰€æœ‰è·¯å¾„ï¼š

```bash
sudo sed -i 's|/var/lib/marzban|/var/lib/pasarguard|g' .env
```

<Alert type="warning">
å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬ï¼ˆ0.8.4 æˆ–æ›´ä½ï¼‰ï¼Œè¿˜éœ€è¦æ›´æ”¹ SQL é©±åŠ¨ç¨‹åºï¼š
</Alert>

<Tabs items={['SQLite', 'MySQL']}>
  <Tab value="SQLite">
    ### SQLite é©±åŠ¨ç¨‹åºæ›´æ–°

    âŒ æ—§ç‰ˆæœ¬
    ```bash
    SQLALCHEMY_DATABASE_URL = "sqlite:///db.sqlite3"
    ```
    âœ… æ–°ç‰ˆæœ¬
    ```bash
    SQLALCHEMY_DATABASE_URL = "sqlite+aiosqlite:///db.sqlite3"
    ```
  </Tab>
  <Tab value="MySQL">
    ### MySQL é©±åŠ¨ç¨‹åºæ›´æ–°

    âŒ æ—§ç‰ˆæœ¬
    ```bash
    SQLALCHEMY_DATABASE_URL = "mysql+pymysql://root:DB_PASSWORD@127.0.0.1/pasarguard"
    ```
    âœ… æ–°ç‰ˆæœ¬
    ```bash
    SQLALCHEMY_DATABASE_URL = "mysql+asyncmy://root:DB_PASSWORD@127.0.0.1/pasarguard"
    ```
  </Tab>
</Tabs>

### 6. æ›´æ–° Docker Compose æ–‡ä»¶

æ›´æ–° `docker-compose.yml` æ–‡ä»¶ä»¥åæ˜ æ–°è·¯å¾„ã€‚æ‚¨éœ€è¦æ‰‹åŠ¨ç¼–è¾‘æ­¤æ–‡ä»¶ï¼š

```bash
sudo nano docker-compose.yml
```

#### Docker Compose æ›´æ”¹

ä»¥ä¸‹æ˜¯æ˜¾ç¤ºå¿…è¦æ›´æ”¹çš„æ¯”è¾ƒï¼š

<div className="grid md:grid-cols-2 gap-4">

<div className="space-y-2">

**âŒ ä¹‹å‰ (Marzban)**
```yaml
services:
  marzban:
    image: gozargah/marzban:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/marzban:/var/lib/marzban
    depends_on:
      - mysql

  mysql:
    image: mysql:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --mysqlx-bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: marzban
    volumes:
      - /var/lib/mysql/marzban:/var/lib/mysql
```

</div>

<div className="space-y-2">

**âœ… ä¹‹å (PasarGuard)**
```yaml
services:
  pasarguard:
    image: pasarguard/panel:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/pasarguard:/var/lib/pasarguard
    depends_on:
      - mysql

  mysql:
    image: mysql:lts
    restart: always
    env_file: .env
    network_mode: host
    command: --bind-address=127.0.0.1 --mysqlx-bind-address=127.0.0.1 --disable-log-bin
    environment:
      MYSQL_DATABASE: marzban
    volumes:
      - /var/lib/mysql/pasarguard:/var/lib/mysql
```

</div>

</div>

#### å…³é”®æ›´æ”¹æ‘˜è¦ï¼š

<div className="overflow-x-auto">
<table>
<thead>
<tr>
<th>éƒ¨åˆ†</th>
<th>ä¹‹å‰</th>
<th>ä¹‹å</th>
</tr>
</thead>
<tbody>
<tr>
<td data-label="éƒ¨åˆ†"><strong>æœåŠ¡åç§°</strong></td>
<td data-label="ä¹‹å‰"><code>marzban</code></td>
<td data-label="ä¹‹å"><code>pasarguard</code></td>
</tr>
<tr>
<td data-label="éƒ¨åˆ†"><strong>Docker é•œåƒ</strong></td>
<td data-label="ä¹‹å‰"><code>gozargah/marzban:latest</code></td>
<td data-label="ä¹‹å"><code>pasarguard/panel:latest</code></td>
</tr>
<tr>
<td data-label="éƒ¨åˆ†"><strong>åº”ç”¨å·</strong></td>
<td data-label="ä¹‹å‰"><code>/var/lib/marzban:/var/lib/marzban</code></td>
<td data-label="ä¹‹å"><code>/var/lib/pasarguard:/var/lib/pasarguard</code></td>
</tr>
<tr>
<td data-label="éƒ¨åˆ†"><strong>MySQL å·</strong></td>
<td data-label="ä¹‹å‰"><code>/var/lib/mysql/marzban:/var/lib/mysql</code></td>
<td data-label="ä¹‹å"><code>/var/lib/mysql/pasarguard:/var/lib/mysql</code></td>
</tr>
</tbody>
</table>
</div>

### 7. æ›´æ–°æ–‡ä»¶æƒé™

ç¡®ä¿æ‚¨å¯¹æ–°ç›®å½•å…·æœ‰å¿…è¦çš„æƒé™ï¼š

#### æƒé™æ›´æ–°å‘½ä»¤

```bash
sudo chown -R $USER:$USER /opt/pasarguard
sudo chmod -R 755 /opt/pasarguard
```

### 8. å®‰è£… PasarGuard ç®¡ç†è„šæœ¬

å®‰è£… PasarGuard ç®¡ç†è„šæœ¬ä»¥ä¾¿äºç®¡ç†ï¼š

#### è„šæœ¬å®‰è£…å‘½ä»¤

```bash
sudo bash -c "$(curl -sL https://github.com/PasarGuard/scripts/raw/main/pasarguard.sh)" @ install-script
```

æ­¤è„šæœ¬ä¸ºç®¡ç†æ‚¨çš„ PasarGuard å®‰è£…æä¾›æœ‰ç”¨çš„å‘½ä»¤ã€‚

### 9. å¯åŠ¨ PasarGuard

ç°åœ¨ä½¿ç”¨æ–°é…ç½®å¯åŠ¨ PasarGuardï¼š

#### å¯åŠ¨å‘½ä»¤

```bash
pasarguard up
```

### 10. éªŒè¯è¿ç§»

æ£€æŸ¥æ‰€æœ‰æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

#### éªŒè¯å‘½ä»¤

```bash
pasarguard status
```

æ‰“å¼€æ‚¨çš„é¢æ¿ URL ä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸å·¥ä½œã€‚

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

> ğŸ’¡ **æç¤º**: å¤§å¤šæ•°é—®é¢˜å¯ä»¥é€šè¿‡æ£€æŸ¥æ–‡ä»¶æƒé™å’Œè·¯å¾„é…ç½®æ¥è§£å†³ã€‚

**1. æƒé™è¢«æ‹’ç»**
ç¡®ä¿æ‚¨ä½¿ç”¨é€‚å½“çš„æƒé™è¿è¡Œå‘½ä»¤ï¼ˆéœ€è¦æ—¶ä½¿ç”¨ sudoï¼‰ã€‚

**2. æ•°æ®åº“è¿æ¥é—®é¢˜**
å¦‚æœæ‚¨ä½¿ç”¨ MySQLï¼Œè¯·æ£€æŸ¥æ•°æ®åº“è·¯å¾„å’Œç™»å½•ä¿¡æ¯æ˜¯å¦æ­£ç¡®æ›´æ–°ã€‚

**3. ç«¯å£å†²çª**
ç¡®ä¿æ²¡æœ‰å…¶ä»–æœåŠ¡ä½¿ç”¨ç›¸åŒçš„ç«¯å£ã€‚

**4. ç¼ºå°‘ç¯å¢ƒå˜é‡**
å†æ¬¡æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„æ‰€æœ‰ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®æ›´æ–°ã€‚

### å›æ»š

> âš ï¸ **ç´§æ€¥å›æ»š**: å¦‚æœæ‚¨é‡åˆ°ä¸¥é‡é—®é¢˜å¹¶éœ€è¦æ¢å¤åˆ°ä»¥å‰ç‰ˆæœ¬

```bash
# åœæ­¢ PasarGuard
cd /opt/pasarguard
docker compose down

# æ¢å¤åŸå§‹ç›®å½•
sudo mv /opt/pasarguard /opt/marzban
sudo mv /var/lib/pasarguard /var/lib/marzban
sudo mv /var/lib/mysql/pasarguard /var/lib/mysql/marzban  # å¦‚æœä½¿ç”¨

# ä»å¤‡ä»½æ¢å¤åŸå§‹ docker-compose.yml å’Œ .env æ–‡ä»¶
# ç„¶åå¯åŠ¨ Marzban
marzban up
```

## è¿ç§»å

æˆåŠŸè¿ç§»åï¼š

- **ğŸ“Š æ›´æ–°ç›‘æ§**: å¦‚æœæ‚¨æœ‰ç›‘æ§å·¥å…·ï¼Œè¯·å°†å®ƒä»¬è¿æ¥åˆ°æ–°è·¯å¾„ã€‚
- **ğŸ’¾ æ›´æ–°å¤‡ä»½**: ç¡®ä¿æ‚¨çš„å¤‡ä»½è„šæœ¬å·²æ›´æ–°ä¸ºä»æ–°ç›®å½•è¿›è¡Œå¤‡ä»½ã€‚
- **ğŸ§ª æµ‹è¯•æ‰€æœ‰åŠŸèƒ½**: å½»åº•æµ‹è¯•æ‰€æœ‰é¢æ¿åŠŸèƒ½ä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸å·¥ä½œã€‚

## æ”¯æŒ

ğŸ”— **é“¾æ¥**

- **è®¨è®ºç»„**: [Telegram](https://t.me/PasarGuardGP)
- **é—®é¢˜**: å¦‚æœæ‚¨åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·åˆ›å»º issueã€‚

---

> **ğŸ“ æ³¨æ„**: æ­¤æŒ‡å—å‡è®¾æ ‡å‡† Marzban å®‰è£…ã€‚è‡ªå®šä¹‰é…ç½®å¯èƒ½éœ€è¦é¢å¤–æ­¥éª¤ã€‚
