---
title: Выпуск SSL-сертификата
navigation: SSL-сертификат
icon: Shield
---

Следующие инструкции предназначены для получения SSL-сертификатов для использования с PasarGuard через командную строку (CLI).

<Callout type="warn">
Файлы сертификатов должны быть доступны по пути `/var/lib/pasarguard/certs`, чтобы PasarGuard мог их использовать.

Во всех примерах ниже файлы будут установлены в этом месте.
</Callout>

<Callout type="warn">
Вы должны зарегистрировать DNS-записи для вашего домена перед получением SSL-сертификата.
</Callout>

## Получение сертификата с помощью acme.sh

### Установка предварительных требований

Установите socat с помощью следующей команды для автономного режима:

```bash
apt install curl socat -y
```

<Callout type="info">
Если вы уже установили socat, вам не нужно выполнять этот шаг.
</Callout>

### Установка acme.sh

Установите [acme.sh](https://github.com/acmesh-official/acme.sh) с помощью следующей команды.

Замените `YOUR_EMAIL` на ваш адрес электронной почты.

<Callout type="info">
Если вы уже установили acme.sh, вам не нужно выполнять этот шаг.
</Callout>

```bash
curl https://get.acme.sh | sh -s email=YOUR_EMAIL
```

### Получение сертификата

Чтобы получить сертификат, выполните следующие команды по порядку.

Замените `YOUR_DOMAIN` на желаемый домен или поддомен.

```bash
export DOMAIN=YOUR_DOMAIN

mkdir -p /var/lib/pasarguard/certs

~/.acme.sh/acme.sh \
  --issue --force --standalone -d "$DOMAIN" \
  --fullchain-file "/var/lib/pasarguard/certs/$DOMAIN.cer" \
  --key-file "/var/lib/pasarguard/certs/$DOMAIN.cer.key"
```

## Получение сертификата для домена Cloudflare

Если ваш домен зарегистрирован в Cloudflare и вышеуказанные методы не работают, используйте ручной режим.

Замените `example.com` на ваш домен.

### Установка acme.sh

После установки acme выполните следующие шаги:

```bash
curl https://get.acme.sh | sh -s email=YOUR_EMAIL
```

### Шаг 1: Запрос сертификата

```bash
~/.acme.sh/acme.sh --issue -d example.com --dns \
 --yes-I-know-dns-manual-mode-enough-go-ahead-please
```

После выполнения вы получите два значения, как показано на изображении ниже:

<ImageZoom
  src="/images/learn/ssl-cloudflare-dns-values.png"
  alt="Значения для проверки DNS Cloudflare"
  width={800}
  height={400}
/>

### Шаг 2: Настройка DNS-записи

Перейдите в Cloudflare и создайте TXT-запись, введя значения, как показано на изображении ниже:

<ImageZoom
  src="/images/learn/ssl-cloudflare-txt-record.png"
  alt="Создание TXT-записи в Cloudflare"
  width={800}
  height={400}
/>

### Шаг 3: Получение сертификата

Получите сертификат с помощью следующей команды:

```bash
~/.acme.sh/acme.sh --renew -d example.com \
  --yes-I-know-dns-manual-mode-enough-go-ahead-please
```

### Пути к файлам

В итоге файл сертификата вашего домена будет находиться по адресу:

```
/root/.acme.sh/example.com_ecc/fullchain.cer
```

А файл закрытого ключа будет сохранен по адресу:

```
/root/.acme.sh/example.com_ecc/example.com.key
```
