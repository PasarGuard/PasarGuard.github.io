---
title: Активация SSL
navigation: Активация SSL
icon: Lock
---

При включении SSL в PasarGuard панель и ссылка на подписку будут доступны через https.
Существует несколько способов включения SSL в PasarGuard, которые мы рассмотрим ниже от простого к сложному.

<Callout type="info">
Во всех примерах ниже файлы `docker-compose.yml` и `.env` находятся в `/opt/PasarGuard`, а `xray_config.json` в `/var/lib/PasarGuard`.

Если вы установили PasarGuard вручную, вам нужно будет внести необходимые изменения самостоятельно.
</Callout>

## Активация SSL с Caddy

В этом методе вам не нужно создавать SSL-сертификат - Caddy сделает всю работу за вас!

### Изменение docker-compose.yml

Измените файл `docker-compose.yml` следующим образом:

```yml {9-10,12-22,24-25}
services:
  PasarGuard:
    image: PasarGuard/panel:latest
    restart: always
    env_file: .env
    network_mode: host
    volumes:
      - /var/lib/PasarGuard:/var/lib/PasarGuard
    depends_on:
      - caddy

  caddy:
    image: caddy
    restart: always
    ports:
      - 80:80
      - 443:443
    volumes:
      - /var/lib/PasarGuard:/var/lib/PasarGuard
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_volume:/data
      - caddy_volume:/config

volumes:
  caddy_volume:
```

### Создание Caddyfile

Создайте новый файл с именем `Caddyfile` в `/opt/pasarguard` и замените `YOUR_DOMAIN` на желаемый домен или поддомен.

<Callout type="warn">
Первая буква в имени файла `Caddyfile` должна быть заглавной `C`.
</Callout>

```nginx
YOUR_DOMAIN {
	reverse_proxy unix//var/lib/pasarguard/pasarguard.socket
}
```

<Callout type="warn">
Если вы хотите, чтобы домен или поддомен подписки отличался от панели, продублируйте приведенное выше содержимое в вашем Caddyfile и замените оба домена или поддомена вместо `YOUR_DOMAIN`.
</Callout>

### Настройка переменных окружения

Установите следующие переменные в файле `.env`.

Замените `YOUR_DOMAIN` на желаемый домен или поддомен.

```bash
UVICORN_UDS = /var/lib/pasarguard/pasarguard.socket
XRAY_SUBSCRIPTION_URL_PREFIX = https://YOUR_DOMAIN
```

### Перезапуск PasarGuard

Перезапустите PasarGuard:

```bash
PasarGuard restart
```

Теперь панель PasarGuard будет доступна по адресу вашего домена или поддомена через https.

## Активация SSL с Uvicorn

PasarGuard по умолчанию работает с `Uvicorn`. `Uvicorn` также позволяет определить файлы SSL-сертификатов.

### Получение SSL-сертификата

Сначала вам нужно получить файлы сертификатов для вашего домена или поддомена. Для этого смотрите руководство [Выпуск SSL-сертификата](ssl-certificate-cli).

### Настройка переменных окружения

После создания файлов SSL-сертификата установите следующие переменные в файле `.env`.

Замените `YOUR_DOMAIN` на желаемый домен или поддомен.

```bash
UVICORN_PORT = 443
UVICORN_SSL_CERTFILE = "/var/lib/PasarGuard/certs/YOUR_DOMAIN.cer"
UVICORN_SSL_KEYFILE = "/var/lib/PasarGuard/certs/YOUR_DOMAIN.cer.key"
XRAY_SUBSCRIPTION_URL_PREFIX = https://YOUR_DOMAIN
```

Теперь панель PasarGuard будет доступна по адресу вашего домена или поддомена через https.

## Активация SSL с HAProxy

`HAProxy` - один из лучших инструментов для этой задачи. В этом методе мы запускаем PasarGuard через https с помощью `HAProxy`.

### Получение SSL-сертификата

Сначала вам нужно получить файлы сертификатов для вашего домена или поддомена. Для этого смотрите руководство [Выпуск SSL-сертификата](ssl-certificate-cli).

### Изменение docker-compose.yml

Измените файл `docker-compose.yml` следующим образом:

```yml {9-10,12-20}
services:
  PasarGuard:
      image: gozargah/PasarGuard:latest
      restart: always
      env_file: .env
      network_mode: host
      volumes:
        - /var/lib/PasarGuard:/var/lib/PasarGuard
      depends_on:
        - haproxy
    
  haproxy:
    image: haproxy:latest
    restart: always
    volumes:
      - ./haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
      - /var/lib/PasarGuard:/var/lib/PasarGuard
    ports:
      - 80:80
      - 443:443
```

### Создание haproxy.cfg

Создайте новый файл с именем `haproxy.cfg` в `/opt/PasarGuard` и замените `YOUR_DOMAIN` на желаемый домен или поддомен.

```ini
defaults
  mode tcp
  timeout client 30s
  timeout connect 4s
  timeout server 30s

global
  maxconn 10000000

frontend http_frontend
  bind *:80
  mode http
  redirect scheme https code 301 if !{ ssl_fc }

frontend https_frontend
  bind *:443 ssl crt /var/lib/PasarGuard/certs/YOUR_DOMAIN.cer
  default_backend PasarGuard_backend

backend PasarGuard_backend
  server PasarGuard /var/lib/pasarguard/pasarguard.socket
```

### Настройка переменных окружения

Установите следующие переменные в файле `.env`.

Замените `YOUR_DOMAIN` на желаемый домен или поддомен.

```bash
UVICORN_UDS = /var/lib/pasarguard/pasarguard.socket
XRAY_SUBSCRIPTION_URL_PREFIX = https://YOUR_DOMAIN
```

### Перезапуск PasarGuard

Перезапустите PasarGuard:

```bash
PasarGuard restart
```

Теперь панель PasarGuard будет доступна по адресу вашего домена или поддомена через https.
